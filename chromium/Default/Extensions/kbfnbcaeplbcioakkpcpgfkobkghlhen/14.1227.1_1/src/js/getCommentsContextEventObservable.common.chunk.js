(self.webpackChunk=self.webpackChunk||[]).push([[4266],{7849:(e,t,n)=>{n.d(t,{$2:()=>p,Hq:()=>i,QY:()=>r,Ue:()=>c,Xw:()=>u,aS:()=>l,fo:()=>h,k4:()=>m,tg:()=>f});var r,s,i,a=n(88359),o=n(69425);function l(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),r=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-r,e.length)}`}function c(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}function u(e){var t;return(null===(t=/^(hwr:\/\/.+$|https?:\/\/[^/]+)/.exec(e))||void 0===t?void 0:t[1])||"Undetermined"}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>a.s.isInsertString(t)?e+a.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>a.s.isDelete(e)));let n=0;return t.forEach((e=>{a.s.isDelete(e)&&(n+=e.delete)})),n},e.getSummary=function(e,t){return t.ops.reduce(((t,n)=>{let{retained:r,retainedPrefix:s,deleted:i,inserted:o,maximalReplacement:l}=t.summary,c=t.pointer;return a.s.isRetain(n)&&(r=`${r}${e.substring(c,c+n.retain)}`,s=0===i.length&&0===o.length?`${s}${e.substring(c,c+n.retain)}`:s,l=l.length?`${l}${e.substring(t.pointer,t.pointer+n.retain)}`:l,c+=n.retain),a.s.isDelete(n)&&(i=`${i}${e.substring(c,c+n.delete)}`,c+=n.delete),a.s.isInsertString(n)&&(o=`${o}${n.insert}`,l=`${l}${n.insert}`),{pointer:c,summary:{retained:r,retainedPrefix:s,deleted:i,inserted:o,maximalReplacement:l}}}),{pointer:0,summary:{retained:"",retainedPrefix:"",deleted:"",inserted:"",maximalReplacement:""}}).summary},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(a.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:a.s.isDelete(n)?t.originalTextPointer+=n.delete:a.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new o.i([]);let n=0;const r=Math.min(e.length,t.length);for(;n<r&&e[n]===t[n];)n++;let s=0;for(;n+s<r&&t[t.length-s-1]===e[e.length-s-1];)s++;const i=e.length-(n+s),a=t.length-(n+s),l=[...n>0?[{retain:n}]:[],...i>0?[{delete:i}]:[],...a>0?[{insert:t.substring(n,n+a)}]:[]];return new o.i(l)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>a.s.isInsertString(e)?!e.insert.length:!a.s.isDelete(e)||!e.delete))}}(r||(r={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(s||(s={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=l(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),r=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===r[t].text&&e.sourceName===r[t].sourceName))}}(i||(i={}));const d=new Set(["'","‘","’","＇","ߴ","ߵ"]),g=new Set(['"',"«","»","","“","”","„","‟","‹","›","❮","❯","❝","❞","❛","❜","〝","〞","⹂"]);function m(e,t,n){var s,i,a,o;const l=r.getSummary(e,t);return".."===l.deleted&&"…"===l.inserted&&"."===(null===(s=n[0])||void 0===s?void 0:s.key)||"…"===l.deleted&&"..."===l.inserted&&""===(null===(i=n[0])||void 0===i?void 0:i.key)||"-"===l.deleted&&"–"===l.inserted&&"-"===(null===(a=n[0])||void 0===a?void 0:a.key)||"–"===l.deleted&&"--"===l.inserted&&""===(null===(o=n[0])||void 0===o?void 0:o.key)?1:0}function h(e,t){return!!e.length&&e.split("").every(((e,n)=>{var r,s,i;return void 0!==(null===(r=t[n])||void 0===r?void 0:r.key)&&(s=t[n].key,i=e,1===s.length&&1===i.length&&(s===i||"'"===s&&d.has(i)||'"'===s&&g.has(i)))}))}function f(e){return e.map((e=>({...e,key:/\p{Letter}/u.test(e.key)?"#":e.key})))}function p(e){try{return e.replace(/<[^>]*>/g,"").replace(/^(\s*)([*\-+]|\d+\.)\s+/gm,"").replace(/!\[(.*?)\][[(].*?[\])]/g,"$1").replace(/\[([^\]]*?)\][[(].*?[\])]/g,"$1").replace(/^(\n)?\s*#{1,6}\s*( (.+))? +#+$|^(\n)?\s*#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/^[=-]{2,}\s*$/gm,"").replace(/^\s*[*\- ]+\s*$/gm,"").replace(/^(\s{0,3}>\s?)+/gm,"").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(`{3,})[\s\S]+?\1\s*/g,"").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1").replace(/ {2}\n/g,"\v ").replace(/\n{2}/g,"\n").replace(/([^\n])$/,"$1\n")}catch(t){return e}}},35778:(e,t,n)=>{n.r(t),n.d(t,{extractGDocsCommentContent:()=>S,getCommentsContextEventObservable:()=>w,getDiff:()=>D,recordChanged:()=>b,transformThreadsToSiblings:()=>v});var r,s=n(72314),i=n(8748),a=n(20715),o=n(25989),l=n(65882),c=n(55446),u=n(14765),d=n(74857),g=n(60841),m=n(65647),h=n(43456),f=n(7849),p=n(91795);!function(e){e.Added="ADDED",e.Removed="REMOVED",e.Updated="UPDATED"}(r||(r={}));var $=n(34770),x=n(55231);function v(e,t,n){return e.map((e=>({docId:n,audience:{channelId:e.id},children:e.messages.map((e=>({audience:{channelId:e.id},authors:[{name:e.author.name,email:e.author.isCurrentSessionUser?t.email:e.author.email,currentSessionUser:e.author.isCurrentSessionUser}],delta:e.delta})))})))}function y(e){return Array.from(e).filter((e=>"classList"in e||!!e.parentElement)).some((e=>{var t;return"classList"in e?e.classList.contains("docos-anchoreddocoview")&&!e.classList.contains("docos-comments-pe")||e.classList.contains("docos-replyview"):null===(t=e.parentElement)||void 0===t?void 0:t.classList.contains("docos-replyview-body")}))}const S=e=>{const t=document.createElement("span");return t.innerHTML=(0,s.sanitize)(e),t.textContent||""};function C(e){return e.messages.some((e=>e.author.isCurrentSessionUser))}function D(e,t){const n=[],s=new Map(e.map((e=>[e.id,e]))),i=new Map(t.map((e=>[e.id,e])));for(const e of t){const t=[],i=s.get(e.id);if(!i){n.push({...e,messages:e.messages.map((e=>({...e,delta:f.QY.singleDelta("",e.content)}))),diffType:r.Added});continue}const a=new Map(i.messages.map((e=>[e.id,e]))),o=new Set(e.messages.map((e=>e.id)));e.messages.forEach((e=>{const n=e.content,r=a.get(e.id),s=r?r.content:"";s!==n&&t.push({...e,delta:f.QY.singleDelta(s,n)})})),i.messages.forEach((e=>{const n=e.content;o.has(e.id)||t.push({...e,delta:f.QY.singleDelta(n,"")})})),t.length&&n.push({...e,messages:t,diffType:r.Updated})}return e.forEach((e=>{i.has(e.id)||n.push({...e,messages:e.messages.map((e=>({...e,delta:f.QY.singleDelta(e.content,"")}))),diffType:r.Removed})})),n}function b(e){return y(e.addedNodes)||y(e.removedNodes)}function w(e,t,n){const r=e.querySelector(".kix-discussion-plugin"),s=(0,x.j)(e.URL)||"";if(!r)return i.E;let f=[];return p.x.createUnsafe(r,{childList:!0,subtree:!0}).pipe((0,c.h)((e=>Array.from(e).some((e=>b(e))))),(0,u.O)(void 0),(0,d.b)(2e3),(0,g.w)((e=>n?(0,o.D)(n().then((e=>{const t=e.filter(C).map((e=>function(e){return{...e,messages:e.messages.map((e=>({...e,content:S(e.content)}))).filter((e=>e.content.length))}}(e))),n=D(f,t);return f=t,n}))):(0,a.of)([]))),(0,c.h)((e=>!!e.length)),(0,g.w)((e=>(0,l.aj)([(0,a.of)(e),t]))),(0,m.U)((([e,t])=>$.t.createDocContextUpdatedEvent({siblings:v(e,t,s)}))),(0,h.d)({bufferSize:1,refCount:!0}))}}}]);