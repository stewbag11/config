(self.webpackChunk=self.webpackChunk||[]).push([[5643],{74951:(e,t,i)=>{i.d(t,{v:()=>C});var n=i(72779),s=i(79992),r=i(70932),o=i(99035),c=i(90023),a=i(82823),l=i(65647),u=i(60841),d=i(20715),p=i(10859),g=i(14765),h=i(60165),m=i(39620),f=i(58303),x=i(25770),v=i(18300);const _=i(57935).E0;class b{constructor(e){this._params=e,this._subscription=new a.w,this._selection=x.h.create(null),this.selection=this._selection.view(),this._subscription.add(e.selectionOrCaretPosition.pipe(l.U((e=>f.WG(e))),u.w((e=>e?d.of(e):p.timer(_).pipe(l.U((()=>this._getCurrentSelection())),g.O(this._getCurrentSelection()),h.x())))).subscribe(m.wW(this._selection)))}_getCurrentSelection(){return(0,c.zG)(this._params.selectionService.getCurrentSelection(),v.Ey)}setSelection(e){this._params.selectionService.setSelection(e)}dispose(){this._subscription.unsubscribe()}}var y=i(35947),T=i(64564);class k{constructor(e){this._params=e,this.getDocumentText=()=>this._params.getCurrentTextMap().getRichText(),this.getDocumentGeometry=()=>{const e=T.i.getVisibleTextRange(this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryProvider,this._params.geometryLayout),t=T.i.getTextFieldBoundingBox(this._params.textField,this._params.textFieldLayout);return e?{visibleTextRange:e,documentFrame:t}:{documentFrame:t}},this.getBoundingBoxesForTextRanges=e=>T.i.getBoundingBoxesForTextRanges(e,this._params.textField,this._params.originalTextField,this._params.doc,this._params.getCurrentTextMap(),this._params.textFieldLayout,this._params.geometryLayout,this._params.geometryProvider),this.setDocumentSelectedTextRange=e=>this._params.selectionService.setSelection(e),this.applyChangesToDocument=e=>{const t=(0,y.g)(e,!0);return this._params.replacementService.performBatchReplacements(t).then((t=>({changes:e,status:t})))}}}class C{constructor(e){var t;this._log=r.Y.create("ConnectorDependenciesImpl"),this._disposableList=[];const i=(0,n.Me)(e.textField);this.target={documentID:s.iy.create(),documentUrl:i.location.href,textField:e.textField,originalTextField:e.originalTextField},this.textRevisionManager=o.X.create(e.textObserver,e.createTextRevisionManager),this.selectionService=new b({selectionService:e.selectionService,selectionOrCaretPosition:e.selectionOrCaretPosition});const c=null!==(t=e.geometryLayout)&&void 0!==t?t:e.integrationLayout.createGeometryLayout();this.connectorHandler=new k({doc:i,replacementService:e.replacementService,textRevisionManager:this.textRevisionManager,geometryLayout:c,selectionService:this.selectionService,textField:e.textField,textFieldLayout:e.integrationLayout.textField,originalTextField:e.originalTextField,geometryProvider:e.geometryProvider,getCurrentTextMap:()=>e.textObserver.getCurrentTextMap()}),this._disposableList.push(this.selectionService)}dispose(){(0,s.jD)(this._disposableList,this._log)}}},64564:(e,t,i)=>{i.d(t,{i:()=>n});var n,s=i(90023),r=i(99607),o=i(30033),c=i(58454),a=i(79992),l=i(78064);!function(e){function t(e){return{x:e.left,y:e.top,width:e.width,height:e.height}}function i(e){const t=e.rect.getCurrent();return{left:t.client.left,top:t.client.top,width:t.size.width,height:t.size.height}}function n(e){const t=e.visibleRect.getCurrent(),i=e.rect.getCurrent(),n=e.scroll.getCurrent(),s=(0,r.jg)(t,i);return s?(0,r.Li)(s,i,n):null}function u(e,t,i,n,s){var r;const c=n.create(e,t);return c?Array.from(null!==(r=n.getClientRects(c))&&void 0!==r?r:[]).filter((e=>e.height>0&&e.width>0)).map((e=>o.UL.setPosition(s.clientToRelative(e),e))).filter((e=>o.UL.contains(e,i))):[]}function d(e,t,i){return[[e.left,e.top+e.height],[e.left+e.width,e.top+e.height]].map((([e,i])=>t.elementFromPoint(e,i))).every((e=>i.some((t=>e===t||t.contains(e)))))}function p(e){return Object.fromEntries(Object.keys(e).map((e=>[e,[]])))}e.getZoomedBoundingBox=function(e,t){return{x:e.x*t,y:e.y*t,width:e.width*t,height:e.height*t}},e.getTextFieldBoundingBox=function(e,n){const s=i(n),r=(0,c.k6)(e);if(!r)return t(s);const a=o.UL.getIntersection(s,r);return t(a?{...a,top:s.top,height:s.height}:s)},e.getRelativeVisibleTextFieldRect=n,e.getVisibleRelativeRectsForTextRange=u,e.getVisibleTextRange=function(e,t,i,s){let r=null;const o=e.getPlainText(),c=n(t);if(!c||!o.length)return r;const a=s.getCurrentConversionContext();for(let t=0;t<o.length;t++){if(u({start:t,end:t+1},e,c,i,a).length>0)r={start:null===r?t:r.start,end:t+1};else if(r&&(0,l.qE)(o.substring(t,t+1)))break}return r},e.isRectElementOnDocumentTop=d,e.createEmptyBoundingBoxesForTextField=p,e.getBoundingBoxesForTextRanges=function(e,r,c,l,g,h,m,f){const x=n(h);if(!x)return p(e);const v=m.getCurrentConversionContext(),_=i(h),b=t(_),y=h.scroll.getCurrent(),T={left:_.left-y.left,top:_.top-y.top},k={left:b.x-y.left,top:b.y-y.top};return Object.fromEntries(Object.entries(e).map((([e,i])=>[e,u(i,g,x,f,v).filter((e=>d(o.UL.shift(e,T),l,[r,c].filter(a.fQ)))).map((e=>(0,s.zG)(o.UL.shift(e,k),t)))])))}}(n||(n={}))},99035:(e,t,i)=>{i.d(t,{X:()=>n});var n,s=i(55446),r=i(68857),o=i(91778);!function(e){e.create=function(e,t=r.n.create){const i=t({getTextSource:()=>e.getTextSource(),getCurrentTextMap:()=>e.getCurrentTextMap(),dispose:()=>e.dispose(),textMapChanged:e.textMapChanged,contentChanges:{async:e.contentChanges.async.pipe(s.h((e=>e.changes.length>0))),immediate:e.contentChanges.immediate.pipe(s.h((e=>e.changes.length>0)))}});return{revisionChanges:i.revisionChanges,getLatestVersionNumber:()=>o.Q.getRevisionNumber(i.getLatestRevision().id),dispose:()=>i.dispose()}}}(n||(n={}))},67896:(e,t,i)=>{i.r(t),i.d(t,{InkwellDocumentIntegrationImpl:()=>w});var n=i(49231),s=i(82823),r=i(70163),o=i(33090),c=i(78084),a=i(25989),l=i(65882),u=i(55446),d=i(73863),p=i(60841),g=i(65647),h=i(60165),m=i(90049),f=i(20715),x=i(14765),v=i(74951),_=i(76667);class b{constructor(e){this._shouldMeasure=e}rxMeasure(e,t){return this._shouldMeasure?_.d5.measure(this.callMeasure(e,t)):_.d5.doNothing}callMeasure(e,t){return i=>{if(this._shouldMeasure){const n=b._eventIndex++,s=performance.mark(`Ink_${e}${n}_start`);try{i()}finally{const i=performance.mark(`Ink_${e}${n}_end`),r=performance.measure(`Ink_${e}${n}_duration`,{start:s.name,end:i.name,detail:{devtools:{dataType:"track-entry",track:"Inkwell Extension",trackGroup:"Inkwell",color:"tertiary-dark",tooltipText:`Inkwell ${e}`}}});t&&t({eventName:e,start:s.startTime,end:i.startTime,duration:r.duration})}}else i()}}}b._eventIndex=0;var y=i(79992),T=i(94525),k=i(91778),C=i(70932),R=i(1873);class w{constructor(e){this._logger=C.Y.create(`Inkwell/${w.name}`),this._disposed=!1,this._subscriptions=new s.w,this._disposables=[];const t=new b(e.measurePerformance),i=new v.v(e),n=e.inkwellPageDynamicService.getSingletonInstance(),p=this._getCAPIMessages(e.checkingService).pipe(r.B());let g=!0;const h=[];this._subscriptions.add(p.subscribe((e=>{g&&h.push(e)})));const m=o.z(c.P((()=>{const e=a.D([...h]);return g=!1,h.length=0,e})),p).pipe(t.rxMeasure("capiMessage")),f=l.aj([e.checkingService.pipe(u.h(y.C_),d.q(1)).toPromise(),n]).pipe(t.rxMeasure("deps"));this._subscriptions.add(f.subscribe((([n,s])=>{this._disposables.push(s.connectDocument({connectorDependencies:i,capiMessages:m,checkingService:n,alertProcessor:e.alertProcessor,isFieldFocused:e.isFieldFocused,textFieldLayout:e.integrationLayout.textField,perf:t}))})))}getDecorationsUI(){return n.createElement("div",null)}dispose(e){this._disposed||(this._disposed=!0,(0,y.jD)(this._disposables,this._logger),this._subscriptions.unsubscribe())}_getCAPIMessages(e){return e.pipe(u.h(y.C_),p.w((e=>e.capiMessages.pipe(u.h((e=>"start"===e.action)),p.w((t=>{const i=t.sessionUuid,n=e.checkingRevisionInfo.pipe(g.U((e=>({kind:"capiTextRevision",sessionId:i,capiTextRevision:k.Q.getRevisionNumber(e.revision)}))),h.x(((e,t)=>e.capiTextRevision===t.capiTextRevision))),s=e.readyState.pipe(u.h((e=>e===T.kQ.disconnected)),g.U((()=>({kind:"capiDisconnected",sessionId:i}))));return m.T(o.z(f.of(t),e.capiMessages.pipe(u.h((e=>!R.j9.has(e.action))))).pipe(g.U((e=>({kind:"capiMessage",sessionId:i,message:e}))),x.O({kind:"capiConnected",sessionId:i})),n,s)}))))))}}},1873:(e,t,i)=>{i.d(t,{C2:()=>m,j9:()=>g,n7:()=>f,yU:()=>h});var n=i(82823),s=i(25989),r=i(60841),o=i(13195),c=i(20715),a=i(65647),l=i(12518),u=i(68259),d=i(70932),p=i(98281);const g=new Set(["sdui:add","sdui:update","sdui:remove"]);class h{constructor(e){this._params=e,this._log=d.Y.create(`Inkwell/${h.name}/dId[${this._params.documentID}]`),this._subs=new n.w,this._subs.add(this._subscribeToCAPIMessages())}dispose(){this._subs.unsubscribe()}async sendCAPIMessage(e){try{const t=await this._params.checkingService.sendMessage(e.message.action,e.message,!0)();if(l.isLeft(t))throw t.left}catch(e){this._log.error("Unexpected error calling checkingService.sendMessage",e)}}_subscribeToCAPIMessages(){return s.D(this._params.inkwellCapiAPI).pipe(r.w((e=>this._params.capiMessages.pipe(o.b((e=>"capiTextRevision"===e.kind?c.of(this._params.getTextRevision()).pipe(a.U((t=>({...e,documentTextRevision:t})))):c.of(e))),a.U((t=>({message:t,capiToInkwell:e}))))))).subscribe((({message:e,capiToInkwell:t})=>{switch(e.kind){case"capiConnected":this._logRejections((()=>t.capiConnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiConnected");break;case"capiDisconnected":this._logRejections((()=>t.capiDisconnected({sessionID:e.sessionId})),"Unexpected rejection from capiToInkwell.capiDisconnected");break;case"capiTextRevision":this._logRejections((()=>t.capiTextRevision({sessionID:e.sessionId,documentRevision:e.documentTextRevision,capiRevision:e.capiTextRevision})),"Unexpected rejection from capiToInkwell.capiTextRevision");break;case"capiMessage":this._logRejections((()=>t.capiMessageReceived({sessionID:e.sessionId,message:e.message})),"Unexpected rejection from capiToInkwell.capiMessageReceived");break;default:(0,u.L0)(e)}}))}_logRejections(e,t){e().catch((e=>this._log.error(t,e)))}}function m(e,t){return{capiConnected:(0,p.i)(e,t.capiConnected),capiDisconnected:(0,p.i)(e,t.capiDisconnected),capiMessageReceived:(0,p.i)(e,t.capiMessageReceived),capiAlertRemoved:(0,p.i)(e,t.capiAlertRemoved),capiTextRevision:(0,p.i)(e,t.capiTextRevision)}}function f(e){return{sendCAPIMessage:(0,p.O)((async t=>(await e(t)).sendCAPIMessage))}}},98281:(e,t,i)=>{function n(e,t){return async i=>null===i?await t(null):await t({...i,documentID:e})}function s(e){return async t=>{const i=await e(t.documentID),n=await i(t);return{documentID:t.documentID,...n}}}i.d(t,{O:()=>s,i:()=>n})},58454:(e,t,i)=>{if(i.d(t,{LJ:()=>f,Nd:()=>c,Ov:()=>m,TW:()=>b,Ur:()=>a,Xs:()=>y,e$:()=>v,eg:()=>_,fN:()=>d,k6:()=>g,kh:()=>u,lW:()=>x,lz:()=>p,qg:()=>o,uj:()=>r,uz:()=>h}),3075==i.j)var n=i(73104);var s=i(91901);function r(e){const t=(0,n.Cq)(e.querySelector(s.XG),"text buffer iframe");return(0,n.Cq)(t.nodeType===Node.ELEMENT_NODE&&"IFRAME"===t.tagName?t.contentDocument:void 0,"text buffer iframe document")}function o(e){const t=c(e);return{width:t?t.offsetWidth-t.clientWidth:0,height:t?t.offsetHeight-t.clientHeight:0}}function c(e){return e.querySelector(s.Wp)}function a(e,t,i){return t?function(e,t){if(t&&l(t))return t;const i=e.querySelectorAll(s.Qy);for(const e of i)if(l(e))return e;return null}(e,i):e.querySelector(s.Qy)}const l=e=>e.checkVisibility?e.checkVisibility():e.parentElement&&"none"!==e.parentElement.style.display;function u(e){return e.querySelectorAll(s.gH)}function d(e){return e.querySelector(s.gH)}function p(e){return Boolean(e.querySelector(s.gH))}function g(e){let t=e.querySelector(s.os);return t||(t=document.querySelector(s.gH)),t?t.getBoundingClientRect():null}const h=e=>!!e.querySelector(s.Lq);function m(e){return e.querySelector(s.$x)}function f(e){return null==e?void 0:e.querySelector(s.y1)}function x(e){const t=e.querySelector(s.f);return!!t&&t.offsetHeight>0}function v(e){return!!e.querySelector(`${s.jW}, ${s.F8}`)}function _(){const e=document.querySelector(s.d0),t=(null==e?void 0:e.classList.contains(s.uj))?"edit":void 0,i=(null==e?void 0:e.classList.contains(s._m))?"suggesting":void 0;return t||i||"other"}function b(e){return e.querySelector(s.QR)}function y(e){return e.querySelector(s.ij)}},91901:(e,t,i)=>{i.d(t,{$x:()=>o,F8:()=>m,Go:()=>s,Kt:()=>y,Lq:()=>l,QR:()=>I,Qy:()=>x,Vk:()=>T,Wp:()=>n,XG:()=>r,_m:()=>p,d0:()=>u,f:()=>a,gH:()=>f,gL:()=>k,ij:()=>w,j5:()=>b,jW:()=>h,l$:()=>g,lO:()=>R,os:()=>_,rx:()=>C,uj:()=>d,y1:()=>c,yw:()=>v});const n=".kix-appview-editor",s=".docos-input",r=".docs-texteventtarget-iframe",o=".kix-cursor",c=".kix-cursor-caret",a="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',u="#docs-toolbar-mode-switcher",d="edit-mode",p="suggest-mode",g="titlebar-mode-indicator-container",h="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",x=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",v=".kix-page-paginated",_=".kix-page-paginated.canvas-first-page",b=".docs-horizontal-ruler",y=".docs-vertical-ruler",T="#fontSizeSelect input",k=".docs-ruler-background",C=".docs-ruler-background-inner",R=".docs-ruler-indent-first-line",w=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'}}]);