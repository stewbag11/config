(self.webpackChunk=self.webpackChunk||[]).push([[5739],{70632:(e,t,n)=>{var r=n(98544),i="chrome-extension://__MSG_@@extension_id__/",a="moz-extension://__MSG_@@extension_id__/",o="safari-web-extension://__MSG_@@extension_id__/",s=self.GR_RESOURCE_ROOT||i,c=self.GR_RESOURCE_ROOT||a,l=self.GR_RESOURCE_ROOT||o;e.exports={__css:r.toString().replace(new RegExp(i,"g"),s).replace(new RegExp(a,"g"),c).replace(new RegExp(o,"g"),l),...r.locals}},83227:(e,t,n)=>{n.r(t),n.d(t,{EditsTrackingControllerImpl:()=>Kn});var r=n(90023),i=n(82823),a=n(36072),o=n(65647),s=n(78488),c=n(55446),l=n(60841),d=n(73863),u=n(8748),h=n(64218),m=n(58303),p=n(68259),g=n(25770),f=n(52341),k=n(72257),_=n(36334),b=n(99836),v=n(4603),y=n(5669),C=n(33874),w=n(34967),S=n(1124),x=n(28440),E=n(69425),I=n(48822),T=n(64965),A=n(70163),R=n(70989),L=n(93899),D=n(52569),M=n(83780),B=n(74857),P=n(97697),G=n(20715),U=n(14765),F=n(78008),N=n(22889),O=n(13195),H=n(44424),W=n(37636),$=n(18615),z=n(70932);const Z="document_state",V="document_state_enc";class K extends Error{constructor(e,t){super(e),this._reason=t}get reason(){return this._reason}}class j extends K{}class Y extends K{}class q extends K{}class Q extends K{}class J extends K{}class X extends Q{}function ee(e,t=Q){return e instanceof K?e:new t(e.message,e)}var te,ne,re,ie;!function(e){let t;!function(e){e.create=function(e){return{timestamp:e.timestamp,delta:e.delta,copyContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return t.timestamp&&!isNaN(t.timestamp)&&t.delta?{timestamp:Number(t.timestamp),delta:t.delta,sourceContentId:t.copyContentId?String(t.copyContentId):void 0,isSelfAuthored:t.isSelfAuthored}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(te||(te={})),function(e){let t,n;!function(e){e.create=function(e){return{timestamp:e.timestamp,text:e.char,copiedContentId:void 0!==e.sourceContentId&&null!==e.sourceContentId&&""!==e.sourceContentId?e.sourceContentId:void 0,isSelfAuthored:e.isSelfAuthored}},e.parse=function(e){try{const t=e;return void 0!==t.text&&t.text.length&&t.timestamp&&void 0!==t.isSelfAuthored?{char:String(t.text),timestamp:Number(t.timestamp),sourceContentId:t.copiedContentId?String(t.copiedContentId):void 0,isSelfAuthored:Boolean(t.isSelfAuthored)}:null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e){return{character:e.char,timestamp:e.timestamp,sourceContentId:e.sourceContentId,isSelfAuthored:e.isSelfAuthored}}}(n=e.Backend||(e.Backend={})),e.is=function(e){return null!==e}}(ne||(ne={})),function(e){let t;e.create=function(e,t,n,r,i){let a=[],o=[],s=[];return r&&((0,p.kG)(n.length==r.length,`Expected that the text length ${n.length} be the same as the Char[] length ${r.length}`),a=r.map((e=>e.timestamp)),o=r.map((e=>e.isSelfAuthored)),s=r.map((e=>e.sourceContentId||null))),{id:crypto.randomUUID(),url:e,sourceName:t,text:n,timestamps:a,isSelfAuthoredTags:o,originalSourceContentIds:s,prompt:i}},function(e){e.create=function(e){return{id:e.id,url:e.url,sourceName:e.sourceName,text:e.text,timestamps:e.timestamps,isSelfAuthoredTags:e.isSelfAuthoredTags,originalCopiedContentIds:e.originalSourceContentIds,prompt:e.prompt||null}},e.parse=function(e){try{const t=e;if(t.id&&t.url&&t.sourceName&&t.text&&Array.isArray(t.timestamps)&&Array.isArray(t.isSelfAuthoredTags)&&Array.isArray(t.originalCopiedContentIds)){const e=t.timestamps.filter((e=>!isNaN(e))),n=t.isSelfAuthoredTags.map(Boolean),r=t.originalCopiedContentIds.filter((e=>null===e||"string"==typeof e));return e.length===n.length&&n.length===r.length?{id:t.id,url:t.url,sourceName:t.sourceName,text:t.text,timestamps:e,isSelfAuthoredTags:n,originalSourceContentIds:r,prompt:t.prompt||void 0}:null}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),e.is=function(e){return null!==e}}(re||(re={})),function(e){let t,n;e.empty=function(e){return{id:e,chars:[],sourcedContentStore:{kind:"internal",data:[]},deltaEdits:[]}},function(e){e.create=function(e){return{id:e.id,chararray:e.chars.map(ne.Legacy.create),copyStore:{storeType:e.sourcedContentStore.kind,data:e.sourcedContentStore.data.map(re.Legacy.create)},deltas:e.deltaEdits.map(te.Legacy.create)}},e.parse=function(e){try{const t=e;if(t.id&&Array.isArray(t.chararray)&&t.copyStore&&t.copyStore.storeType&&Array.isArray(t.copyStore.data)&&Array.isArray(t.deltas)){const e=t.chararray.map(ne.Legacy.parse).filter(ne.is),n=t.copyStore.data.map(re.Legacy.parse).filter(re.is),r=t.deltas.map(te.Legacy.parse).filter(te.is);return e.length!==t.chararray.length||n.length!==t.copyStore.data.length||r.length!==t.deltas.length?null:{id:t.id,chars:e,sourcedContentStore:{kind:t.copyStore.storeType,data:n},deltaEdits:r}}return null}catch(e){return null}}}(t=e.Legacy||(e.Legacy={})),function(e){e.create=function(e,t,n){return{documentId:e.id,chars:e.chars.map(ne.Backend.create),sourcedContentStore:{kind:e.sourcedContentStore.kind,data:e.sourcedContentStore.data},deltaEdits:e.deltaEdits,title:n}}}(n=e.Backend||(e.Backend={}))}(ie||(ie={}));const ae="AES-GCM",oe={name:ae},se={length:256,...oe};function ce(e){return{iv:e,...oe}}function le(){if(!self.crypto)throw new Q("Crypto API is not supported in this browser")}async function de(e){le();const t=await self.crypto.subtle.exportKey("raw",e);return new Uint8Array(t)}var ue=n(31753);class he{static ofRequest(e){return new Promise(((t,n)=>{e.onsuccess=n=>t(e.result),e.onerror=t=>n(e.error)}))}static ofTransaction(e){return new Promise(((t,n)=>{e.oncomplete=e=>t(),e.onerror=t=>n(e.error)}))}}function me(e){return t=>`${e}-${t}`}function pe(e){return function(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n].toString(16).padStart(2,"0");return t.join("")}((0,ue.Bk)((new TextEncoder).encode(e)))}class ge{serialize(e){return Promise.resolve(ie.Legacy.create(e))}deserialize(e){const t=ie.Legacy.parse(e);return t?Promise.resolve(t):Promise.reject(new Y("Document could not be parsed"))}}class fe{constructor(e,t){this.keychain=t,this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder,this.uniqId=me(e),this.userId=e}async serialize(e){try{const t=await this.keychain.getOrProvisionKey(e.id,this.userId),n=JSON.stringify(e),r=this.textEncoder.encode(n),i=await async function(e,t){le();const n=self.crypto.getRandomValues(new Uint8Array(12));return{iv:n,encrypted:await self.crypto.subtle.encrypt(ce(n),t,e)}}(r,t);return{id:this.uniqId(e.id),documentId:e.id,data:i}}catch(e){throw ee(e,Q)}}async deserialize(e){const{documentId:t,data:n}=e,r=await this.keychain.getKey(t,this.userId);if(!r)throw new Y("Key not found for document");try{const e=await function(e,t){le();const{iv:n,encrypted:r}=e;return self.crypto.subtle.decrypt(ce(n),t,r)}(n,r);return JSON.parse(this.textDecoder.decode(e))}catch(e){throw ee(e,Y)}}}class ke{constructor(e,t,n,r,i,a){this.userId=e,this.documentId=t,this.keychain=n,this._onReadCallback=r,this._onReadErrorCallback=i,this._onWriteResultCallback=a,this._initialized=g.h.create(!1),this._initialHistoryLength=null,this._encryptionSerializer=new fe(this.userId,this.keychain),this._legacySerializer=new ge,this._log=z.Y.create("HWRStorage"),this.uniqId=me(e)}async reload(){if(this._log.info("reload"),this._db=await this._openDb(),!this._db)return this._log.error("Cannot open db"),void this._onReadErrorCallback(new X);try{const e=await this._fetchFromEncrypted(this._db);if(e)return void this._onReadSuccess(e);const t=await this._fetchFromLegacy(this._db);t?(await this._migrateToEncrypted(this._db,t),this._onReadSuccess(t)):this._onReadErrorCallback(new j)}catch(e){this._onReadErrorCallback(ee(e))}finally{this._initialized.set(!0)}}async writeDocumentState(e){if(await this._isInitialized(),!this._db)return void this._onWriteResultCallback("error",new X);const t=(0,b.Tb)().humanWritingReport;if(null!==this._initialHistoryLength&&this._initialHistoryLength>e.deltaEdits.length){const n=`Document history was lost: ${this._initialHistoryLength} -> ${e.deltaEdits.length}`;t.error("storageError",n)}try{const t=await this._encryptionSerializer.serialize(e),n=this._db.transaction([V],"readwrite");n.objectStore(V).put(t),await he.ofTransaction(n),this._onWriteResultCallback("success")}catch(e){return void this._onWriteResultCallback("error",ee(e))}}async _fetchFromEncrypted(e){const t=this.uniqId(this.documentId),n=e.transaction([V],"readonly"),r=n.objectStore(V),i=await he.ofRequest(r.get(t));return await he.ofTransaction(n),i?await this._encryptionSerializer.deserialize(i):null}async _fetchFromLegacy(e){if(!e.objectStoreNames.contains(Z))return null;const t=this.documentId,n=e.transaction([Z],"readonly"),r=n.objectStore(Z),i=await he.ofRequest(r.get(t));return await he.ofTransaction(n),i?await this._legacySerializer.deserialize(i):null}async _migrateToEncrypted(e,t){this._log.info("Migrating document to encrypted storage");try{const n=t.id,r=await this._encryptionSerializer.serialize(t),i=e.transaction([V,Z],"readwrite");i.objectStore(V).put(r),i.objectStore(Z).delete(n),await he.ofTransaction(i)}catch(e){const t=(0,b.Tb)().humanWritingReport,n=(null==e?void 0:e.message)||"Unknown error";throw t.error("storageError",`Couldn't migrate document to encrypted storage: ${n}`),ee(e)}}_isInitialized(){return this._initialized.pipe(c.h((e=>e)),$.P()).toPromise()}async _openDb(){const e=indexedDB.open("human_writing_report",2);e.onupgradeneeded=this._onUpgradeNeeded.bind(this);try{return await he.ofRequest(e)}catch(e){return null}}_onUpgradeNeeded(e){const t=e.target,n=t.result;if(t.result&&t.transaction)try{n.objectStoreNames.contains(V)||n.createObjectStore(V,{keyPath:"id",autoIncrement:!1})}catch(e){this._onReadErrorCallback(ee(e))}else this._onReadErrorCallback(new X)}_onReadSuccess(e){this._onReadCallback(e),null===this._initialHistoryLength&&(this._initialHistoryLength=e.deltaEdits.length)}}var _e=n(97521);class be{constructor(e){this._client=e}async getKey(e,t){const n=be.createKeyId(e),r=await this.fetchKey(n,t);if(!r)return null;const i=(0,_e.K9)(r);return await function(e,t=!1,n=["encrypt","decrypt"]){return le(),self.crypto.subtle.importKey("raw",e,ae,t,n)}(i)}async getOrProvisionKey(e,t){let n=0;for(;n<=3;)try{return await this.getKey(e,t)||await this.provisionKey(e,t)}catch(e){if(e instanceof J){if(n++<=2)continue;if(e.reason)throw ee(e.reason,Q);throw new Q("Too many retries")}throw ee(e)}throw new Q("Too many retries")}async provisionKey(e,t){const n=be.createKeyId(e),r=await(le(),self.crypto.subtle.generateKey(se,!0,["encrypt","decrypt"]));return await this.storeKeys([{keyId:n,key:r}],t),r}static createKeyId(e){return pe("key-"+e)}async fetchKey(e,t){const n=await this._client.getEncryptionKey({keyId:e,userId:t});return null==n?void 0:n.keyMaterial}async storeKeys(e,t){const n=[];for(const t of e){const e=await de(t.key);n.push({id:t.keyId,keyMaterial:(0,_e.J2)(e)})}await this._client.createEncryptionKeys({keys:n,userId:t})}}var ve=n(88359),ye=n(5768),Ce=n(7849),we=n(79992),Se=n(36482),xe=n(11456),Ee=n(68485),Ie=n(38508);const Te=n(72138);class Ae{constructor(){this._log=z.Y.create("GoogleDocsSourcedContentStore")}getMatch(e,t){var n;let r=null,i=0;try{if(t.length&&e.deleted.length>0&&e.deleted.length<=ye.QU&&e.maximalReplacement.startsWith(`${e.deleted[0].toUpperCase()}${e.deleted.substring(1)}`)){const n=e.maximalReplacement.substring(e.deleted.length),a=n.split("").filter(((e,n)=>e===t[n].key)).length;a===n.length&&(r=re.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),i=a)}else t.length&&e.inserted.length<=ye.QU&&/\S[\s)."'?!]$/.test(e.inserted)&&Te(e.maximalReplacement,e.deleted)<=e.deleted.length/1.5&&e.maximalReplacement[e.maximalReplacement.length-1]===t[0].key?(r=re.create("hwr://delta/rewrite/google/correct/","Google Docs Corrections",e.maximalReplacement),i=1):0==e.deleted.length&&e.inserted.length<=ye._f&&e.inserted.trim().length>0&&"\t"===(null===(n=t[0])||void 0===n?void 0:n.key)&&(r=re.create("hwr://delta/rewrite/google/completion/","Google Docs Smart Compose Suggestions",e.maximalReplacement),i=1)}catch(e){this._log.error("getMatch has thrown",e)}return r&&this._log.debug(`[GoogleDocsSuggestionStore] getMatch('${e.maximalReplacement}') returning:`,r),Promise.resolve(r?{sourcedContent:r,matchedTrustedEventsCount:i}:null)}}var Re,Le=n(75352);!function(e){e.Internal="internal",e.Selection="selection",e.GrammarlyPrevious="grammarly-previous",e.GrammarlyCurrent="grammarly-current",e.External="external",e.GDocs="gdocs",e.Startup="startup",e.Temporary="temporary",e.Test="test"}(Re||(Re={}));class De{constructor(e,t=[],n=1/0){this.kind=e,this.data=t,this._maxRecordsCount=n,this._sourcedContentById=new Map,this.data.forEach((e=>{this._sourcedContentById.set(e.id,e)})),this._log=z.Y.create(`[${this.kind}] ${De.name}`),this._keepLastN()}getMatch(e,t){var n;let r=this.data;t&&(r=this.data.filter(t));const i=e.inserted.length&&e.inserted===e.deleted?e.inserted.trim():e.maximalReplacement.trim(),a=r.find((({text:e})=>e.trim()===i))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getMatch('${(0,Ce.aS)(e.maximalReplacement,40)}') returning:`,a),a}getFuzzyMatch(e,t){var n;const r=e.maximalReplacement,i=(1-t)*r.length,a=this.data.find((e=>{var t,n;const a=(0,Ce.$2)(e.text),o=Le.zI.diffAsChanges(a,r);return null===(t=this._log)||void 0===t||t.info(`[FuzzyMatch] text length: ${r.length}, amount changed: ${o.amount}`),null===(n=this._log)||void 0===n||n.info("Delta",o),o.amount<=i&&!Ce.Hq.hasPerLetterTags(e)}))||null;return null===(n=this._log)||void 0===n||n.info(`[${this.kind}] getFuzzyMatch('${(0,Ce.aS)(r,40)}') returning:`,a),a}getContentById(e){return this._sourcedContentById.get(e)||null}addContent(e){var t;null===(t=this._log)||void 0===t||t.debug("addContent",e),this.data.push(e),this._sourcedContentById.set(e.id,e),this._keepLastN()}_keepLastN(){this.data.length<=this._maxRecordsCount||(this.data.slice(0,this.data.length-this._maxRecordsCount).forEach((({id:e})=>{this._sourcedContentById.delete(e)})),this.data=this.data.slice(-this._maxRecordsCount))}}class Me{constructor(e,t,n,r,i){this.text=e,this.delta=t,this.timestamp=n,this.sourcedContent=r,this.isWholeDeltaSelfAuthored=i,null!=r&&r.timestamps.length>0&&((0,p.kG)(e.length==r.timestamps.length),(0,p.kG)(e.length==r.isSelfAuthoredTags.length),(0,p.kG)(e.length==r.originalSourceContentIds.length))}getCharAt(e){var t,n,r;const i=null!=this.sourcedContent?this.sourcedContent.timestamps:[],a=(null===(t=this.sourcedContent)||void 0===t?void 0:t.isSelfAuthoredTags)||[],o=(null===(n=this.sourcedContent)||void 0===n?void 0:n.originalSourceContentIds)||[];let s=this.timestamp;const c=this.isWholeDeltaSelfAuthored||!!this.sourcedContent&&Boolean(a[e]);let l=(null===(r=this.sourcedContent)||void 0===r?void 0:r.id)||null;return i.length>0&&(s=i[e],l=o[e]||l),{char:this.text[e],timestamp:s,sourceContentId:l||void 0,isSelfAuthored:c}}}function Be(e,t,n){if(0===t.length)return 0;const r=(0,Ce.k4)(n,e,t);return r>0?r:e.ops.reduce(((e,r,i,a)=>{if(e.eventsIndex>=t.length)return i!==a.length-1||!("delete"in r)||"insert"in r&&""!==r.insert?{...e,matched:0,eventsIndex:e.eventsIndex}:e;if("retain"in r){const o=function(e,t,n=3){var r;let i=0;const a=Math.min(e.length,t.length,n)-1;for(let n=a;n>=0&&e[e.length-1-n]===(null===(r=t[a-n])||void 0===r?void 0:r.key);n--)i++;return i}(n.substring(0,e.textIndex+r.retain),t);if(o){let r=e.eventsIndex+o,s=e.textIndex+o;a.slice(i+1).every((e=>{var i;if("retain"in e){if(!(0,Ce.fo)(n.substring(s,s+e.retain),t.slice(r)))return!1;r+=e.retain,s+=e.retain}if("delete"in e){if(""!==(null===(i=t[r])||void 0===i?void 0:i.key)&&void 0!==t[r])return!1;r+=e.delete}if("insert"in e){const n=e.insert;if(!(0,Ce.fo)(n,t.slice(r)))return!1;r+=n.length}return!0}))&&(e.matched+=o,e.eventsIndex+=o)}e.textIndex+=r.retain}if("delete"in r&&r.delete>0)for(e.textIndex+=r.delete;e.eventsIndex<t.length&&""===t[e.eventsIndex].key;)e.matched+=1,e.eventsIndex+=1;if("insert"in r){const n=r.insert;if(!(0,Ce.fo)(n,t.slice(e.eventsIndex)))return{...e,matched:0,eventsIndex:1/0};e.matched+=n.length,e.eventsIndex+=n.length}return e}),{matched:0,eventsIndex:0,textIndex:0}).matched}class Pe{constructor(e,t,n,r,a){this._documentId=e,this._sessionId=t,this._events=n,this._trustedEvents=r,this._initialized=g.h.create(!1),this._chars=[],this._deltaEdits=[],this._last_updated_at=Date.now(),this._log=z.Y.create("ChangeTrackerImpl"),this._lastClientInfo=null,this._lastSessionId=null,this._subs=new i.w;const{buildInfo:o,appConfig:s}=a.config;this._currentClientInfo={clientName:s.gnar.appName,version:o.version},this._internalCopyStore=new De(Re.Internal,[]),this._internalSelectionStore=new De(Re.Selection,[],2),this._prevGrammarlyAlerts=new De(Re.GrammarlyPrevious),this._currentGrammarlyAlerts=new De(Re.GrammarlyCurrent),this._externalCopyStore=new De(Re.External,[],4),this._googleDocsSourcedContentStore=new Ae,this.startupCopyStore=new De(Re.Startup,[],4),this._subs.add(this._events.pipe(c.h((e=>"genAIResultCopied"===e.kind))).subscribe((e=>this._handleGenAICopyEvents(e.text,e.prompt))))}async updateKnownDocumentState(e,t){const n=(0,b.Tb)().humanWritingReport;if(this._deltaEdits.length>0&&e.deltaEdits.length<this._deltaEdits.length){const t=`Attempt to update known document state with outdated state: ${e.deltaEdits.length}`;return n.error("changeTracking",t),void this._log.error(t)}if(this._initialized.get()&&this._documentId!==e.id){const t=`Attempt to update known document state with different document ID: ${e.id}`;n.error("changeTracking",t),this._log.error(t)}this._chars=e.chars,this._internalCopyStore=new De(Re.Internal,e.sourcedContentStore.data),this._deltaEdits=e.deltaEdits;const r=this._deltaEdits.reduce(((e,t)=>{let n=e;return t.clientInfo&&(n={...n,clientInfo:t.clientInfo}),t.sessionId&&(n={...n,sessionId:t.sessionId}),n}),{clientInfo:null,sessionId:null});this._lastClientInfo=r.clientInfo,this._lastSessionId=r.sessionId,this._initialized.set(!0);const i=Ce.QY.singleDelta(e.chars.map((e=>e.char)).join(""),t);Ce.QY.isNoTextChangesDelta(i)?(this._log.info("No changes since last known state."),this._events.next({kind:"knownStateMatch"})):(this._log.info("Known document state is different from current",i),this._events.next({kind:"knownStateMismatch",lengthDifference:Math.abs(Ce.QY.getNumInsertedLetters(i)+Ce.QY.getNumDeletedLetters(i))})),i.forEach((e=>{ve.s.isInsertString(e)&&this.startupCopyStore.addContent(re.create("hwr://delta/startup/","Delta on Document load",e.insert))})),await this.onTextChange(i)}async onTextChange(e){if(0===e.ops.length)return 0;const t=ve.s.normalizeDelta(e);const n=Be(t,this._trustedEvents.get(),this._chars.map((e=>e.char)).join(""));n||this._log.debug("delta is not typed",{normalizedDelta:t,trustedEvents:this._trustedEvents.get()});const r=Date.now(),{deltaEdit:i,matchedTrustedEventsCount:a}=await this._applyDelta(t,r,n);return this._lastClientInfo=this._currentClientInfo,this._lastSessionId=m.WG(this._sessionId.get()),this._deltaEdits.push(i),this._last_updated_at=Date.now(),n||a}onSelectionChange(e){e.forEach((e=>{if(e.start!=e.end&&e.end-e.start>1){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._internalSelectionStore.addContent(re.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",t,n)),this._events.next({kind:"sourceAdded",textLength:e.end-e.start,sourceDomain:self.location.origin,promptDetected:!1})}}))}onAlertChange(e){const t=new De(Re.Temporary);for(const[n,r]of Object.entries(e)){if(void 0===r||!xe.S.isCapiAlert(r))continue;const e=r.text;r.replacements.forEach((r=>{const i=Ce.QY.extractMaximalReplacementString(e,Ce.QY.singleDelta(e,r));i&&t.addContent(re.create("hwr://delta/rewrite/grammarly/correct/?id="+n,"Grammarly edited: ("+e+" -> "+r+")",i))}))}Ce.Hq.eq(t.data,this._currentGrammarlyAlerts.data)||(this._prevGrammarlyAlerts=new De(Re.GrammarlyPrevious,this._currentGrammarlyAlerts.data),this._currentGrammarlyAlerts=new De(Re.GrammarlyCurrent,t.data))}addCopiedTextToExternalStore(e){if(!e.valid)return;const t=e.copiedText||"";null==this._externalCopyStore.getMatch(Ce.QY.getSummary("",(new E.i).insert(t)))&&this._externalCopyStore.addContent(re.create(e.sourceURL||"",e.sourceName||"",t,void 0,e.userPrompt))}onReplacementApplied(e,t){if(e===Ee.P.snippets||e===Ee.P.oggyGenAI){let n="";void 0!==t.pos&&(n=this._chars.slice(t.pos.start,t.pos.end).map((e=>e.char)).join(""));const r=Ce.QY.extractMaximalReplacementString(n,"string"==typeof t.value?Ce.QY.singleDelta(n,t.value):t.value);r&&this._internalCopyStore.addContent(re.create("hwr://delta/rewrite/grammarly/"+e,"Grammarly generated ("+e+")",r))}}getDocumentState(){if(!this._initialized.get())throw new Error("ChangeTracker is not initialized");return{id:this._documentId,chars:this._chars,sourcedContentStore:{kind:"internal",data:this._internalCopyStore.data},deltaEdits:this._deltaEdits}}getReportableDocument(){if(!this._initialized.get())throw new Error("ChangeTracker is not initialized");return ie.Backend.create(this.getDocumentState(),this._last_updated_at,document.title)}getTextInfoForAlert(e){const t=[];return(0,Se.C)(e).forEach((e=>{if("transform"==e.meta.rangePurpose)for(let n=e.start;n<e.end;++n)t.push({...this._chars[n]})})),t}_applySingleDeletion(e,t){this._chars.splice(e,t)}_applySingleInsertion(e,t){const n=t.text.length,r=Array.from({length:n},((e,n)=>t.getCharAt(n)));this._chars.splice(e,0,...r)}async _searchAllCopyStores(e){let t=this._prevGrammarlyAlerts.getMatch(e);if(t)return{storeKind:Re.GrammarlyPrevious,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalCopyStore.getMatch(e,(e=>"hwr://delta/startup/"!=e.url)),t)return{storeKind:this._internalCopyStore.kind,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._internalSelectionStore.getMatch(e),t)return{storeKind:Re.Selection,sourcedContent:t,matchedTrustedEventsCount:0};if(t=this._externalCopyStore.getMatch(e),t)return{storeKind:Re.External,sourcedContent:t,matchedTrustedEventsCount:0};const n=await this._googleDocsSourcedContentStore.getMatch(e,this._trustedEvents.get());return n?{storeKind:Re.GDocs,sourcedContent:n.sourcedContent,matchedTrustedEventsCount:n.matchedTrustedEventsCount}:(t=this.startupCopyStore.getMatch(e),t?{storeKind:Re.Startup,sourcedContent:t,matchedTrustedEventsCount:0}:(t=this._externalCopyStore.getFuzzyMatch(e,.95),t?{storeKind:Re.External,sourcedContent:t,matchedTrustedEventsCount:0}:null))}async _applyDelta(e,t,n){let r=null,i=0;const a=this._chars.map((e=>e.char)).join(""),o=Ce.QY.getSummary(a,e),s=ve.s.normalizeDelta(ve.s.cleanAllAttrs(Ce.QY.singleDelta(a,(0,Ie.l)(e,a)))),c=n>0&&o.maximalReplacement.length<=ye.dL;n>0&&o.maximalReplacement.length>ye.dL&&(0,b.Tb)().humanWritingReport.error("changeTracking","False positive typed match",void 0,{insertionLength:o.maximalReplacement.length,matchedLength:n,trustedEvents:(0,Ce.tg)(this._trustedEvents.get())}),this._log.debug("_applyDelta summary",o);const l=o.deleted.length&&o.deleted===o.inserted,d=l?o:Ce.QY.getSummary(a,s),u=l?e:s;let h=null;c||(h=d.maximalReplacement.length?await this._searchAllCopyStores(d):null),r=(null==h?void 0:h.sourcedContent.id)||null,h&&h.storeKind!=Re.Internal&&this._internalCopyStore.addContent(h.sourcedContent);for(const e of u.ops)ve.s.isRetain(e)?i+=e.retain:ve.s.isInsertString(e)?(this._applySingleInsertion(i,new Me(e.insert,u,t,(null==h?void 0:h.sourcedContent)||null,c)),i+=e.insert.length):ve.s.isDelete(e)&&(this._trackDeletion(i,e.delete),this._applySingleDeletion(i,e.delete));if(!c&&r){const e=this._internalCopyStore.getContentById(r);e?this._events.next({kind:"sourcedTextAdded",sourceDomain:(0,Ce.Xw)(e.url),textLength:d.maximalReplacement.length,promptDetected:Boolean(e.prompt)}):this._events.next({kind:"unknownSourceTextAdded",textLength:d.maximalReplacement.length})}else c||this._events.next({kind:"unknownSourceTextAdded",textLength:d.maximalReplacement.length});const p=m.WG(this._sessionId.get());return{deltaEdit:{timestamp:t,delta:u,sourceContentId:r||void 0,isSelfAuthored:c,clientInfo:(0,we.fS)(this._currentClientInfo,this._lastClientInfo)?void 0:this._currentClientInfo,sessionId:this._lastSessionId===p?void 0:p||void 0},matchedTrustedEventsCount:(null==h?void 0:h.matchedTrustedEventsCount)||0}}_trackDeletion(e,t){const n=Array.from({length:t},((t,n)=>this._chars[e+n])),r=n.map((e=>e.char)).join("");this._onCopyDelete(r,n)}_onCopyDelete(e,t){e.length>=ye.Uv&&this._internalCopyStore.addContent(re.create(`hwr://delta/document/google/${this._documentId}`,self.name||"Unnamed",e,t))}onCopy(e){e.forEach((e=>{if(e.start!=e.end){const t=this._chars.slice(e.start,e.end).map((e=>e.char)).join(""),n=this._chars.slice(e.start,e.end);this._onCopyDelete(t,n)}}))}_getCSSFormatForLetter(e){const t="color: red;",n="color: black;",r=e.sourceContentId,i=null!=r?this._internalCopyStore.getContentById(r):null;let a;return a=null!=i?i.url.match(/delta\/rewrite\/grammarly\/(oggyGenAI|snippets)/)?"color: blue;":i.url.match("delta/rewrite/grammarly/correct")?"color: green;":i.url.match(/(chat.openai.com|chatgpt.com)/)?"color: purple;":i.url.match("gemini.google.com")?"color: orange;":i.url.match("delta/rewrite/google")?"color: teal;":i.url.match("delta/startup")?t:e.isSelfAuthored?n:t:e.isSelfAuthored?n:t,a}_logText(){const e=this._chars.map((e=>`%c${e.char}`)).join(""),t=this._chars.map((e=>this._getCSSFormatForLetter(e)));self.console.log(`HWR: ${e}`,...t)}_handleGenAICopyEvents(e,t){e.length&&this._internalCopyStore.addContent(re.create(`hwr://delta/rewrite/grammarly/${Ee.P.oggyGenAI}`,`Grammarly generated (${Ee.P.oggyGenAI})`,e,void 0,t))}dispose(){this._subs.unsubscribe()}}class Ge{constructor(e,t,n,r,i,o,s,c,l,d,u,h){this._listenerId=e,this._alertsState=t,this._textObserver=n,this._selectionSource=r,this._CSState=i,this._replacementListener=o,this._events=s,this._encryptionService=c,this._errors=l,this._keyboardEventsSource=d,this._env=u,this._sessionId=h,this._subs=new I.L,this._trackingState=g.h.create("dormant"),this._documentRetrievalState=g.h.create("dormant"),this._textChangeProcessingState=g.h.create("idle"),this._log=z.Y.create("HWRListenerImpl"),this._documentVisibilityObs=T.R(document,"visibilitychange").pipe(A.B()),this._documentStateSubj=new a.xQ,this._writeToStorageRequestSubj=new a.xQ,this._trustedEvents=g.h.create([]),this._integrationTestsEventsLogger=null;const m=(0,b.Tb)().humanWritingReport;this._setupKeyboardEventsHandling(),this._log.info("Document id",e);const p=new W.m;this._documentId=p.documentID||this._listenerId,this._changeTracker=new Pe(this._documentId,this._sessionId,s,this._trustedEvents.view(),this._env);const f=i.view("user").view("id").get();this._keychain=new be(this._encryptionService),this._hwrStorage=new ke(f,this._documentId,this._keychain,(e=>{this._log.info("Document state read: success"),this._documentStateSubj.next(e)}),(e=>{this._log.error("Storage read error:",e),this._handleStorageError(e,m)}),((e,t)=>{t?(this._log.error("Storage write error:",t),this._handleStorageError(t,m)):this._log.info("Storage write status",e)})),this._log.info("HWR Storage initialized"),this._setupEventHandlers()}_logIntegrationTestsEvent(e){var t;null===(t=this._integrationTestsEventsLogger)||void 0===t||t.call(this,{...e,timestamp:Date.now()})}_handleStorageError(e,t){e instanceof j?this._documentStateSubj.next(ie.empty(this._documentId)):e instanceof Y?(this._documentStateSubj.next(ie.empty(this._documentId)),this._errors.next({kind:"databaseCorrupted"}),t.error("storageError",`Database corrupted: ${e.name}, '${e.message}'`)):e instanceof q?(this._errors.next({kind:"serverError",errorMessage:e.message}),t.error("storageError",`Server error: ${e.name}, '${e.message}'`)):e instanceof Q?(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),t.error("storageError",`Unrecoverable error: ${e.name}, '${e.message}'`)):(this._errors.next({kind:"unrecoverableError",errorMessage:e.message}),t.error("storageError",`Unknown error: ${e.name}, '${e.message}'`))}get changeTracker(){return this._changeTracker}get documentId(){return this._documentId}_setupEventHandlers(){this._subs.add(this._replacementListener.obs.pipe(R.M(this._trackingState),c.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._logIntegrationTestsEvent({kind:"replacement",data:e}),this._changeTracker.onReplacementApplied(e.source,e.replacement)}))),this._subs.add(this._alertsState.subscribe((e=>{this._logIntegrationTestsEvent({kind:"alertState",data:e}),this._changeTracker.onAlertChange(e)})));const e=this._textObserver.contentChanges.async.pipe(c.h((({changes:e})=>e.length>0)),s.b((e=>{this._logIntegrationTestsEvent({kind:"contentChanges",data:e})})),R.M(this._trackingState,this._documentRetrievalState),c.h((([e,t,n])=>"active"===t&&"ok"===n)),o.U((([e])=>e)),A.B());this._subs.add(e.pipe(L.f(this._textChangeProcessingState.pipe(D.a(e.pipe(M.g(0))),c.h((([e])=>"idle"===e)))),c.h((e=>e.length>0)),s.b((e=>{this._log.debug("buffer emit",e.length)}))).subscribe((e=>{this._handleTextChange(e)}))),this._subs.add(this._selectionSource.data.changes.pipe(s.b((e=>{this._logIntegrationTestsEvent({kind:"selectionChange",data:e})})),R.M(this._trackingState),c.h((([e,t])=>"active"===t))).subscribe((([e])=>{this._changeTracker.onSelectionChange(e)}))),this._subs.add(this._writeToStorageRequestSubj.pipe(R.M(this._documentRetrievalState),c.h((([e,t])=>"ok"===t)),B.b(1e3)).subscribe((()=>{this._writeToStorage()}))),this._documentVisibilityObs.pipe(o.U((()=>document.hidden)),l.w((e=>P.s((()=>e),G.of(!0),G.of(!1).pipe(M.g(300)))))).subscribe((e=>{e?this._stopTrackingWhenHidden():this._resumeTrackingWhenVisible()})),this._subs.add(this._documentStateSubj.pipe(U.O(null),R.M(this._documentVisibilityObs.pipe(o.U((()=>document.hidden)),U.O(document.hidden)),this._trackingState)).subscribe((([e,t,n])=>{t||null==e||"active"!==n||this._handleDocumentStateChange(e)}))),this._subs.add(this._CSState.view("copiedTextMessage").pipe(s.b((e=>{this._logIntegrationTestsEvent({kind:"copiedTextMessage",data:e})}))).subscribe())}_setupKeyboardEventsHandling(){const e=(0,v.OB)().config.systemInfo.os.isMac;this._subs.add(this._keyboardEventsSource.pipe(s.b((e=>{this._logIntegrationTestsEvent({kind:"keyboardEvent",data:e})})),c.h((t=>t.isTrusted&&(1===t.key.length||"Enter"===t.key||"Tab"===t.key||"Backspace"===t.key||"Delete"===t.key)&&!t.ctrlKey&&(e?!t.metaKey:!t.altKey))),R.M(this._trackingState,this._documentRetrievalState),c.h((([e,t,n])=>"active"===t&&"ok"===n))).subscribe((([e])=>{this._trustedEvents.modify((t=>{return t.concat({timestamp:Date.now(),key:(n=e,"Enter"===n.key?"\n":"Tab"===n.key?"\t":"Backspace"===n.key||"Delete"===n.key?"":n.key)});var n}))})))}_startTracking(){this.retreiveDocument(),this._changeTracker.addCopiedTextToExternalStore(this._CSState.view("copiedTextMessage").get())}async retreiveDocument(){this._documentRetrievalState.set("waiting"),await this._hwrStorage.reload(),this._documentRetrievalState.set("ok")}startTracking(){this._trackingState.set("active"),this._startTracking()}stopTracking(){this._log.info("Stopping document tracking"),this._trackingState.set("paused"),this._documentRetrievalState.set("dormant")}getReportableDocument(){return"dormant"===this._documentRetrievalState.get()&&this.retreiveDocument(),this._documentRetrievalState.pipe(c.h((e=>"ok"===e)),d.q(1),F.V(2e3),N.a((e=>e.pipe(O.b(((e,t)=>P.s((()=>t>0),H._(new Error("Document state is not OK after 4000ms, failing")),G.of(e).pipe(s.b((()=>{(0,b.Tb)().humanWritingReport.warning("reportGenerationFailed",JSON.stringify({documentId:this.documentId,warning:"Document state is not OK after 2000ms, retrying"}))}))))))))),o.U((()=>this._changeTracker.getReportableDocument()))).toPromise()}_stopTrackingWhenHidden(){this._log.info("Pausing document tracking while document is not visible"),this._trackingState.modify((e=>"active"===e?"dormant":e))}_resumeTrackingWhenVisible(){this._log.info("Resuming document tracking after document became visible"),this._trackingState.modify((e=>"paused"===e?e:"active")),"active"===this._trackingState.get()&&this._startTracking()}async _handleDocumentStateChange(e){this._log.info("Got saved or Empty document.",e),await this._changeTracker.updateKnownDocumentState(e,this._textObserver.getCurrentTextMap().getPlainText()),await this._writeToStorage()}async _writeToStorage(){try{await this._hwrStorage.writeDocumentState(this._changeTracker.getDocumentState())}catch(e){this._log.error("Error writing to storage:",e),this._handleStorageError(e,(0,b.Tb)().humanWritingReport)}}async _handleTextChange(e){this._textChangeProcessingState.set("processing");const t=this._CSState.view("copiedTextMessage").get();this._changeTracker.addCopiedTextToExternalStore(t);for(const t of e)if(t.deltaChange.delta.ops.length>0){const e=await this._changeTracker.onTextChange(new E.i(t.deltaChange.delta.ops));this._trustedEvents.modify((t=>t.length-e>15?(this._log.debug("too many unmatched events, clearing them up"),(0,b.Tb)().humanWritingReport.error("changeTracking","Too many trusted events left unmatched",void 0,{count:t.length,max:15}),[]):(this._log.debug("cleaned up trusted events",{before:t,after:t.slice(e),matched:e}),t.slice(e))))}this._textChangeProcessingState.set("idle"),this._writeToStorageRequestSubj.next()}dispose(){this._subs.unsubscribe(),this._changeTracker.dispose(),this._writeToStorage()}}var Ue=n(49231),Fe=n(39620),Ne=n(80724),Oe=n(65802),He=n(52811),We=n(10859),$e=n(42822),ze=n(53829),Ze=n(74514),Ve=n(90049),Ke=n(91901),je=n(91795);const Ye={offsetLeft:"20px",offsetBottom:"20px"},qe=()=>G.of(Ye),Qe=()=>{const e=document.querySelector(".left-sidebar-container-content .navigation-widget"),t=document.querySelector(Ke.Qy),n=document.querySelector(Ke.os);return e&&t&&n?je.x.create(e,{attributes:!0,subtree:!1,childList:!1}).pipe(c.h((e=>e.some((e=>"style"===e.attributeName)))),o.U((t=>/opacity: 0/.test(e.getAttribute("style")||""))),U.O(/opacity: 0/.test(e.getAttribute("style")||"")),l.w((e=>e?G.of(Ye):Ve.T(je.x.create(t,{attributes:!0,subtree:!1,childList:!1}).pipe(c.h((e=>e.some((e=>"style"===e.attributeName))))),T.R(self,"resize")).pipe(o.U((()=>n.getBoundingClientRect().x)),U.O(n.getBoundingClientRect().x),o.U((e=>({offsetLeft:`${e+20}px`,offsetBottom:"20px"}))))))):G.of(Ye)};var Je=n(43818),Xe=n(75787),et=n(72698),tt=n(54104),nt=n(16587),rt=n(80936),it=n(88190),at=n(33969),ot=n(8775),st=n(77365);const ct={width:Xe.ux.rem(5.1875),height:Xe.ux.rem(5.1875/4.61)},lt={$nest:{"& .gds-modal-content":{minWidth:"438px"},"& .gds-modal-medium":{width:"438px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Xe.ux.rem(et.x0)},"& .gds-heading-large":{fontSize:Xe.ux.rem(2.25),lineHeight:"1.11em"}}},dt=Xe.ux.stylesheet({logo:[ct],modal:[lt]}),ut=$e.UI.Node.make((({notify:e})=>Ue.createElement(tt.u_,{isOpen:!0,onClose:e({kind:"clipboardRequestResult",result:"close"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog",className:dt.modal},Ue.createElement(tt.u_.Body,null,Ue.createElement(st.o,null,Ue.createElement(nt.k,{direction:"column",gap:10},Ue.createElement(rt.c,{className:dt.logo}),Ue.createElement(nt.k,{direction:"column",gap:3},Ue.createElement(it.X,{as:"h1",variant:"heading-large"},"Allow clipboard",Ue.createElement("br",null),"access to track",Ue.createElement("br",null),"writing accurately"),Ue.createElement(at.x,{as:"p"},"We need access to your clipboard so we can record the sources you use. We’ll use it to identify text you copy and paste from websites plus links to those sites.")),Ue.createElement(nt.k,{direction:"row",gap:3},Ue.createElement(ot.z,{text:"Allow access",variant:"primary",onClick:e({kind:"clipboardRequestResult",result:"allow"})}),Ue.createElement(ot.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardRequestResult",result:"deny"})}))))))));var ht=n(80882);const mt=$e.UI.Node.make((({notify:e})=>Ue.createElement(tt.u_,{isOpen:!0,onClose:e({kind:"feedbackPopupClose"}),title:"",dismissOnOutsideClick:!1,width:"small",role:"alertdialog"},Ue.createElement(tt.u_.Body,null,Ue.createElement(ht.b,{onClose:e({kind:"feedbackPopupClose"}),align:"left",onSubmit:t=>e({kind:"feedbackSubmit",feedback:t.text})(),withScore:!1,fixSubmitButtonOverflowBottomPadding:!0,hideLogo:!0,title:"How can we improve?"})))));var pt=n(91321),gt=n(33585),ft=n(68567),kt=n(78519),_t=n(99627),bt=n(4203);var vt=n(27645);const yt=[{id:"transparency",title:Ue.createElement(nt.k,{align:"center",gap:2},Ue.createElement((()=>Ue.createElement("svg",{width:"23",height:"32",viewBox:"0 0 23 32",fill:"none"},Ue.createElement("path",{d:"M3.58829 4.35H15.2974C17.0724 4.35 18.5357 5.85744 18.5357 7.75342V23.8537C18.5357 25.7497 17.0724 27.2571 15.2974 27.2571H3.58829C1.81326 27.2571 0.35 25.7497 0.35 23.8537V7.75342C0.35 5.85744 1.81326 4.35 3.58829 4.35Z",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M4 8.5H11.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M4 17.5H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M4 13H14.89",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M13.704 24.3143C17.1757 24.3143 19.9901 21.4731 19.9901 17.9684C19.9901 14.4637 17.1757 11.6226 13.704 11.6226C10.2323 11.6226 7.41797 14.4637 7.41797 17.9684C7.41797 21.4731 10.2323 24.3143 13.704 24.3143Z",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M8 19.4951C8 19.4951 8.17677 19.4951 9.69062 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M12 19.4951C12 19.4951 12.4182 19.4951 16 19.4951",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M8 15.5645H10.9419",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M13.5 15.5645H16",stroke:"#1C1C1C",strokeWidth:"0.7",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),Ue.createElement("path",{d:"M21.9414 26.6366C22.0781 26.7733 22.2997 26.7733 22.4364 26.6366C22.5731 26.4999 22.5731 26.2783 22.4364 26.1416L21.9414 26.6366ZM18.0523 22.7475L21.9414 26.6366L22.4364 26.1416L18.5473 22.2525L18.0523 22.7475Z",fill:"#1C1C1C"}))),null),Ue.createElement(at.x,{variant:"text-small",as:"p",weight:"normal"},"We’re transparent about data")),Content:({learnMoreURL:e})=>Ue.createElement(nt.k,{direction:"column",gap:2},Ue.createElement(at.x,{variant:"text-xsmall",as:"p"},"Grammarly Authorship records your writing activity when you turn it on in a document. The data it gathers includes: text you type and delete, text you paste from other websites and links to those sites, and prompts you send to generative AI tools."),Ue.createElement(pt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Ue.createElement(at.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Ue.createElement(ft.J,{icon:kt.n,accessibilityLabel:"",variant:"inherit",className:vt.linkIcon}))))},{id:"safety",title:Ue.createElement(nt.k,{align:"center",gap:2},Ue.createElement((()=>Ue.createElement("svg",{width:"21",height:"32",viewBox:"0 0 21 32",fill:"none"},Ue.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.09141 3C6.66135 3 4.69141 4.96994 4.69141 7.4V13.0256C4.69141 15.4557 6.66136 17.4256 9.09141 17.4256H11.947C14.3771 17.4256 16.347 15.4557 16.347 13.0256V7.4C16.347 4.96995 14.3771 3 11.947 3H9.09141ZM9.98539 5.49507C8.57706 5.49507 7.43539 6.63675 7.43539 8.04507V11.8101C7.43539 13.2184 8.57706 14.3601 9.98538 14.3601H11.0786C12.4869 14.3601 13.6286 13.2184 13.6286 11.8101V8.04507C13.6286 6.63675 12.4869 5.49507 11.0786 5.49507H9.98539Z",fill:"white"}),Ue.createElement("path",{d:"M5.04141 7.4C5.04141 5.16324 6.85465 3.35 9.09141 3.35V2.65C6.46805 2.65 4.34141 4.77664 4.34141 7.4H5.04141ZM5.04141 13.0256V7.4H4.34141V13.0256H5.04141ZM9.09141 17.0756C6.85466 17.0756 5.04141 15.2624 5.04141 13.0256H4.34141C4.34141 15.649 6.46806 17.7756 9.09141 17.7756V17.0756ZM11.947 17.0756H9.09141V17.7756H11.947V17.0756ZM15.997 13.0256C15.997 15.2624 14.1838 17.0756 11.947 17.0756V17.7756C14.5704 17.7756 16.697 15.649 16.697 13.0256H15.997ZM15.997 7.4V13.0256H16.697V7.4H15.997ZM11.947 3.35C14.1838 3.35 15.997 5.16325 15.997 7.4H16.697C16.697 4.77665 14.5704 2.65 11.947 2.65V3.35ZM9.09141 3.35H11.947V2.65H9.09141V3.35ZM7.78539 8.04507C7.78539 6.83005 8.77036 5.84507 9.98539 5.84507V5.14507C8.38376 5.14507 7.08539 6.44345 7.08539 8.04507H7.78539ZM7.78539 11.8101V8.04507H7.08539V11.8101H7.78539ZM9.98538 14.0101C8.77036 14.0101 7.78539 13.0251 7.78539 11.8101H7.08539C7.08539 13.4117 8.38376 14.7101 9.98538 14.7101V14.0101ZM11.0786 14.0101H9.98538V14.7101H11.0786V14.0101ZM13.2786 11.8101C13.2786 13.0251 12.2936 14.0101 11.0786 14.0101V14.7101C12.6802 14.7101 13.9786 13.4117 13.9786 11.8101H13.2786ZM13.2786 8.04507V11.8101H13.9786V8.04507H13.2786ZM11.0786 5.84507C12.2936 5.84507 13.2786 6.83004 13.2786 8.04507H13.9786C13.9786 6.44345 12.6802 5.14507 11.0786 5.14507V5.84507ZM9.98539 5.84507H11.0786V5.14507H9.98539V5.84507Z",fill:"#1C1C1C"}),Ue.createElement("rect",{x:"0.35",y:"10.5629",width:"20.3",height:"17.5082",rx:"2.41596",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.7",strokeLinecap:"round"}),Ue.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.4866 20.0964C12.2255 19.7611 12.7339 19.0611 12.7339 18.2517C12.7339 17.1165 11.7338 16.1963 10.5002 16.1963C9.26654 16.1963 8.26648 17.1165 8.26648 18.2517C8.26648 19.061 8.77474 19.7611 9.51355 20.0963V22.3355C9.51355 22.8803 9.95524 23.322 10.5001 23.322C11.045 23.322 11.4866 22.8803 11.4866 22.3355V20.0964Z",fill:"white"}),Ue.createElement("path",{d:"M11.4866 20.0964L11.342 19.7776L11.1366 19.8708V20.0964H11.4866ZM9.51355 20.0963H9.86355V19.8708L9.65818 19.7776L9.51355 20.0963ZM12.3839 18.2517C12.3839 18.9067 11.9722 19.4918 11.342 19.7776L11.6313 20.4151C12.4789 20.0305 13.0839 19.2154 13.0839 18.2517H12.3839ZM10.5002 16.5463C11.5685 16.5463 12.3839 17.3367 12.3839 18.2517H13.0839C13.0839 16.8964 11.8991 15.8463 10.5002 15.8463V16.5463ZM8.61648 18.2517C8.61648 17.3367 9.43186 16.5463 10.5002 16.5463V15.8463C9.10121 15.8463 7.91648 16.8964 7.91648 18.2517H8.61648ZM9.65818 19.7776C9.02814 19.4917 8.61648 18.9066 8.61648 18.2517H7.91648C7.91648 19.2154 8.52134 20.0304 9.36892 20.415L9.65818 19.7776ZM9.86355 22.3355V20.0963H9.16355V22.3355H9.86355ZM10.5001 22.972C10.1485 22.972 9.86355 22.687 9.86355 22.3355H9.16355C9.16355 23.0736 9.76194 23.672 10.5001 23.672V22.972ZM11.1366 22.3355C11.1366 22.687 10.8517 22.972 10.5001 22.972V23.672C11.2383 23.672 11.8366 23.0736 11.8366 22.3355H11.1366ZM11.1366 20.0964V22.3355H11.8366V20.0964H11.1366Z",fill:"#1C1C1C"}))),null),Ue.createElement(at.x,{variant:"text-small",as:"p",weight:"normal"},"We’ll keep your data safe")),Content:({learnMoreURL:e})=>Ue.createElement(nt.k,{direction:"column",gap:2},Ue.createElement(at.x,{variant:"text-xsmall",as:"p"},"When you start Authorship, its data is stored on your device in an encrypted format. When you see or share your report, this data is sent to Grammarly over an encrypted connection."),Ue.createElement(pt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Ue.createElement(at.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Ue.createElement(ft.J,{icon:kt.n,accessibilityLabel:"",variant:"inherit",className:vt.linkIcon}))))},{id:"control",title:Ue.createElement(nt.k,{align:"center",gap:2},Ue.createElement((()=>Ue.createElement("svg",{width:"22",height:"32",viewBox:"0 0 22 32",fill:"none"},Ue.createElement("rect",{x:"0.375",y:"6.375",width:"21.25",height:"7.25",rx:"3.625",fill:"#B3F8F8",stroke:"#1C1C1C",strokeWidth:"0.75"}),Ue.createElement("circle",{cx:"18",cy:"10",r:"3.625",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Ue.createElement("rect",{x:"-0.375",y:"0.375",width:"21.25",height:"7.25",rx:"3.625",transform:"matrix(-1 0 0 1 21.25 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}),Ue.createElement("circle",{cx:"4",cy:"4",r:"3.625",transform:"matrix(-1 0 0 1 8 18)",fill:"white",stroke:"#1C1C1C",strokeWidth:"0.75"}))),null),Ue.createElement(at.x,{variant:"text-small",as:"p",weight:"normal"},"You’re always in control")),Content:({learnMoreURL:e})=>Ue.createElement(nt.k,{direction:"column",gap:2},Ue.createElement(at.x,{variant:"text-xsmall",as:"p"},"You choose when Authorship tracks your writing activity and when you share your report. You can stop sharing your report or delete your writing activity data anytime."),Ue.createElement(pt.r,{href:e,variant:"primary",weight:"bold",target:"_blank",underline:"hover"},Ue.createElement(at.x,{variant:"text-xsmall",as:"span"},"Learn more"," ",Ue.createElement(ft.J,{icon:kt.n,accessibilityLabel:"",variant:"inherit",className:vt.linkIcon}))))}],Ct={width:Xe.ux.rem(5.1875),height:Xe.ux.rem(5.1875/4.61)},wt={$nest:{"& .gds-modal-content":{minWidth:"860px"},"& .gds-modal-medium":{width:"860px"},"& .gds-modal-header":{display:"none"},"& .gds-modal-body":{padding:Xe.ux.rem(et.x0)},"& .gds-heading-large":{fontSize:Xe.ux.rem(2.25),lineHeight:"1.11em"}}},St=Xe.ux.stylesheet({logo:[Ct],link:[{whiteSpace:"normal"}],linkIcon:[{verticalAlign:"top"}],flip:[{transform:"rotate(180deg)"}],modal:[wt]}),xt=(0,_t.xb)(pt.r),Et=(0,_t.xb)((({learnMoreURLs:e})=>{const[t,n]=Ue.useState([]);return Ue.createElement("div",{className:vt.accordionRoot},Ue.createElement("div",null,yt.map((({id:r,title:i,Content:a})=>{const o=t.includes(r),s=`optInAccordion-title-${r}`,c=`optInAccordion-content-${r}`;return Ue.createElement("div",{key:r,className:`${vt.accordionItem}`},Ue.createElement("button",{id:s,className:vt.accordionHeader,onClick:()=>{n(o?[]:[r])},"aria-controls":c,"aria-expanded":o},Ue.createElement("div",{className:vt.accordionTrigger},i,Ue.createElement(nt.k,{className:`${vt.accordionIcon} ${o?vt.rotate:""}`},Ue.createElement(ft.J,{size:"large",icon:bt.p,accessibilityLabel:o?"Collapse section":"Expand section"})))),Ue.createElement("div",{role:"region","aria-labelledby":s,className:`${vt.accordionContent} ${o?vt.shown:""}`},Ue.createElement(a,{learnMoreURL:e[r]})))}))))})),It=$e.UI.Node.make((({view:e,state:t,notify:n})=>Ue.createElement(tt.u_,{isOpen:!0,onClose:n({kind:"closeOptInPopup"}),title:"",dismissOnOutsideClick:!1,width:"medium",role:"alertdialog",className:St.modal},Ue.createElement(tt.u_.Body,null,Ue.createElement(st.o,null,Ue.createElement(nt.k,{direction:"row",gap:6},Ue.createElement(nt.k,{direction:"column",gap:10,flex:"1 1 50%"},Ue.createElement(rt.c,{className:St.logo}),Ue.createElement(nt.k,{direction:"column",gap:3},Ue.createElement(gt.V,{variant:"addition",label:"Beta"}),Ue.createElement(it.X,{as:"h1",variant:"heading-large"},"Prove where your",Ue.createElement("br",null),"words come from"),Ue.createElement(at.x,{as:"p"},"With Grammarly Authorship, you can certify what you type, copy, or generate with AI. You choose how to share this information."),Ue.createElement(xt,{href:e("howItWorksURL"),variant:"primary",weight:"bold",target:"_blank",underline:"hover"},"See how it works"," ",Ue.createElement(ft.J,{icon:kt.n,accessibilityLabel:"",variant:"inherit",className:St.linkIcon}))),Ue.createElement(ot.z,{text:"OK",onClick:n({kind:"optIn"})})),Ue.createElement(nt.k,{direction:"column",gap:3,flex:"1 1 50%",align:"stretch"},Ue.createElement(nt.k,{direction:"row",flex:"1 0 0%",align:"center"},Ue.createElement(Et,{learnMoreURLs:t.pipe(o.U((({learnMoreTransparencyURL:e,learnMoreSafetyURL:t,learnMoreControlURL:n})=>({transparency:e,safety:t,control:n}))))})),Ue.createElement(at.x,{as:"p",color:"base-subdued",variant:"text-xsmall"},"By tracking writing activity, the Beta terms in your agreement with Grammarly (",Ue.createElement(pt.r,{href:"https://www.grammarly.com/terms/customer-business-agreement",variant:"secondary",className:St.link},"Customer Business Agreement"),", ",Ue.createElement(pt.r,{href:"https://www.grammarly.com/terms",variant:"secondary",className:St.link},"Terms and Conditions")," ","and our"," ",Ue.createElement(pt.r,{href:"https://www.grammarly.com/privacy-policy",variant:"secondary",className:St.link},"Privacy Policy"),", as applicable) will apply.")))))))),Tt=$e.UI.Union.make("kind",{optIn:It,clipboardAccess:ut,feedback:mt}),At=$e.UI.Union.asOption(Tt);var Rt=n(72633);const Lt=Xe.ux.stylesheet({toast:[{$nest:{"&&":{minWidth:"376px"}}}]}),Dt=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"success",text:"Grammarly is tracking your writing activity in this document. Click the icon to stop tracking or see your report.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Mt=(0,_t.xb)(Rt.F),Bt=$e.UI.Node.make((({state:e,notify:t})=>Ue.createElement(Mt,{variant:"success",text:e.pipe(o.U((({domain:e,wasNewDocument:t})=>`Authorship ${t?"is tracking your writing activity in this doc. It will start tracking":"will start tracking your writing activity"} anytime you create a new ${"docs.google.com"===e?"Google doc":`doc on ${e}`}.`))),onClose:t({kind:"dismissToast"}),onMouseEnter:t({kind:"toastHover",hovered:!0}),onMouseLeave:t({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Pt=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"success",text:"Grammarly Authorship is turned off. If you want the option to track your writing activity, you can turn it on in Settings.",primaryAction:Ue.createElement(ot.z,{text:"OK",variant:"primary",onClick:e({kind:"optOutToastOkClick"})}),onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Gt=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"success",text:"Grammarly Authorship is now available. Start it to track your writing activity in a doc.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Ut=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"critical",text:"Could not generate Authorship Report. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Ft=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"critical",text:"An error occurred while saving your editing history data.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Nt=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"critical",text:"Could not retrieve editing history data. Tracking will start from scratch.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Ot=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"critical",text:"An error occurred while communicating with the server. Please try again later.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Ht=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"warning",text:"Authorship lost access to your clipboard, so it can’t accurately record text you copy and paste. Try restarting your browser.",onClose:e({kind:"dismissToast"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),Wt=$e.UI.Node.make((({notify:e})=>Ue.createElement(Rt.F,{variant:"warning",text:"Without clipboard access, Authorship will mark any text you paste as “Copied from unknown source.” To accurately record your sources, allow clipboard access.",primaryAction:Ue.createElement(ot.z,{text:"Allow clipboard access",variant:"primary",onClick:e({kind:"clipboardWarningResult",result:"allow"})}),secondaryAction:Ue.createElement(ot.z,{text:"Deny",variant:"ghost",onClick:e({kind:"clipboardWarningResult",result:"deny"})}),onClose:e({kind:"clipboardWarningResult",result:"close"}),onMouseEnter:e({kind:"toastHover",hovered:!0}),onMouseLeave:e({kind:"toastHover",hovered:!1}),className:Lt.toast}))),$t=$e.UI.Union.make("kind",{documentTrackingStarted:Dt,domainTrackingStarted:Bt,domainTrackingStartedWhenAlreadyTracked:Bt,optedOut:Pt,optedIn:Gt,reportGenerationFailed:Ut,clipboardWarning:Wt,clipboardPermissionRequestFailed:Ht,storageUnrecoverableError:Ft,storageDatabaseCorrupted:Nt,storageServerError:Ot}),zt=$e.UI.Union.asOption($t);var Zt=n(84654);const Vt=Xe.ux.keyframes({"0%":{transform:"scale(1)",opacity:.5},"75%":{transform:"scale(6)",opacity:0},"100%":{transform:"scale(6)",opacity:0}}),Kt={width:Xe.ux.rem(.5),height:Xe.ux.rem(.5),borderRadius:Xe.ux.rem(.25),position:"relative",backgroundColor:Zt.I.Background.Brand.Default,overflow:"visible",$nest:{"&:before":{content:"' '",width:"100%",height:"100%",borderRadius:"50%",position:"absolute",backgroundColor:Zt.I.Background.Brand.Default,top:0,left:0,transformOrigin:"50% 50%",animationName:Vt,animationDuration:"1.5s",animationIterationCount:"infinite",animationDirection:"normal",animationFillMode:"backwards"}}},jt=Xe.ux.stylesheet({dot:[Kt]}),Yt=()=>Ue.createElement("div",{className:jt.dot}),qt=()=>Ue.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Ue.createElement("path",{d:"M14 20a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0-1a5 5 0 1 0-.001-10.001A5 5 0 0 0 14 19Zm-2-7.7c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088a.305.305 0 0 1 .084.212v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088A.305.305 0 0 1 12 16.7v-5.4Zm2.857 0c0-.08.03-.156.084-.212a.279.279 0 0 1 .202-.088h.571c.076 0 .149.032.202.088A.305.305 0 0 1 16 11.3v5.4c0 .08-.03.156-.084.212a.279.279 0 0 1-.202.088h-.571a.279.279 0 0 1-.202-.088.305.305 0 0 1-.084-.212v-5.4Z",fill:"inherit"}),Ue.createElement("path",{d:"M6.964 14.924a6.912 6.912 0 0 1-.726-.148v-1.963a.425.425 0 1 0-.85-.001v1.683a7.013 7.013 0 0 1-2.651-1.881V8a5.264 5.264 0 0 1 10.426-1.025 6.987 6.987 0 0 0-.886.161A4.364 4.364 0 0 0 3.638 8v3.5a.425.425 0 1 0 .85 0V8a3.512 3.512 0 0 1 6.972-.608 7.066 7.066 0 0 0-.856.395A2.612 2.612 0 0 0 5.388 8v2.625a.425.425 0 1 0 .85 0V8a1.762 1.762 0 0 1 3.524 0v.325a7.057 7.057 0 0 0-2.798 6.599Zm7.054-7.998A6.113 6.113 0 0 0 1.888 8v3.412A7.004 7.004 0 0 1 8 1a7.005 7.005 0 0 1 6.927 5.986 7.166 7.166 0 0 0-.909-.06ZM7.575 8v.75a.425.425 0 1 0 .85 0V8a.425.425 0 1 0-.85 0Z",fill:"#027e6f"})),Qt=()=>Ue.createElement("svg",{viewBox:"0 0 20 20",fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2"},Ue.createElement("path",{d:"M4 15.289V10a6 6 0 1 1 12 0v5.289a7.98 7.98 0 0 1-1 .954V13a.5.5 0 0 0-1 0v3.928c-.32.186-.654.349-1 .49V10a3 3 0 1 0-6 0v3a.5.5 0 0 0 1 0v-3a2 2 0 1 1 4 0v7.748a8.062 8.062 0 0 1-1.5.237V13.5a.5.5 0 0 0-1 0v4.485a8.062 8.062 0 0 1-1.5-.237V15.5a.5.5 0 0 0-1 0v1.918a8.022 8.022 0 0 1-3-2.129Zm10.474-4.29L14.5 11l.021-.003c.096-.016.479-.105.479-.508V10a5 5 0 0 0-10 0v4.5a.5.5 0 0 0 1 0V10a4 4 0 0 1 8 0l.5.5-.5-.5v.5a.5.5 0 0 0 .474.499ZM3 13.873A7.954 7.954 0 0 1 2 10c0-4.415 3.585-8 8-8a8.004 8.004 0 0 1 7 11.874V10a7 7 0 1 0-14 0v3.873ZM9.5 10v1a.5.5 0 0 0 1 0v-1a.5.5 0 0 0-1 0Z",fill:"inherit"})),Jt={$nest:{svg:{width:Xe.ux.rem(1.25),height:Xe.ux.rem(1.25),fill:Zt.I.Icon.Brand.Default}}},Xt={position:"absolute",right:Xe.ux.rem(-.25),top:Xe.ux.rem(-.25)},en=Xe.ux.stylesheet({icon:[Jt],button:[{background:"none",border:"none",cursor:"pointer",position:"relative"}],attractSequnce:[Xt]}),tn=$e.UI.Node.make((({view:e,notify:t,state:n})=>Ue.createElement(Ue.Fragment,null,Ue.createElement(Je.F.button,{className:en.button,"aria-label":e("trackingState").pipe(o.U((e=>"tracking"===e?"Press to pause authorship tracking":"Press to start authorship tracking"))),onClick:t({kind:"trackingButtonClick"})},Ue.createElement(Je.F.div,{className:en.icon},e("trackingState").pipe(o.U((e=>"tracking"===e?Ue.createElement(qt,null):Ue.createElement(Qt,null)))),n.pipe(o.U((({optInPopupWasClosedOnce:e,trackingState:t})=>!e&&"available"===t&&Ue.createElement("div",{className:en.attractSequnce},Ue.createElement(Yt,null))))))))));var nn=n(18213),rn=n(1148),an=n(16309),on=n(76670),sn=n(54089);const cn=()=>Ue.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Ue.createElement("path",{d:"M13.257,10.429C13.408,10.338 13.5,10.176 13.5,10C13.5,9.824 13.408,9.662 13.257,9.571L8.257,6.571C8.103,6.479 7.91,6.476 7.754,6.565C7.597,6.654 7.5,6.82 7.5,7L7.5,13C7.5,13.18 7.597,13.346 7.754,13.435C7.91,13.524 8.103,13.521 8.257,13.429L13.257,10.429ZM12.028,10L8.5,12.117C8.5,12.117 8.5,7.883 8.5,7.883L12.028,10Z",fill:"inherit"}),Ue.createElement("path",{d:"M9.8,2.183C5.437,2.183 1.9,5.72 1.9,10.083C1.9,14.446 5.437,17.983 9.8,17.983C14.162,17.983 17.7,14.446 17.7,10.083C17.7,5.72 14.162,2.183 9.8,2.183ZM9.8,3.183C13.61,3.183 16.7,6.272 16.7,10.083C16.7,13.894 13.61,16.983 9.8,16.983C5.989,16.983 2.9,13.894 2.9,10.083C2.9,6.272 5.989,3.183 9.8,3.183Z",fill:"inherit"})),ln=()=>Ue.createElement("svg",{fill:"none",fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"2",viewBox:"0 0 20 20"},Ue.createElement("path",{id:"Vector",d:"M7.714,6.914C7.714,6.823 7.749,6.736 7.81,6.672C7.871,6.608 7.954,6.571 8.041,6.571L8.694,6.571C8.781,6.571 8.864,6.608 8.925,6.672C8.986,6.736 9.02,6.823 9.02,6.914L9.02,13.086C9.02,13.177 8.986,13.264 8.925,13.328C8.864,13.392 8.781,13.429 8.694,13.429L8.041,13.429C7.954,13.429 7.871,13.392 7.81,13.328C7.749,13.264 7.714,13.177 7.714,13.086L7.714,6.914ZM10.98,6.914C10.98,6.823 11.014,6.736 11.075,6.672C11.137,6.608 11.22,6.571 11.306,6.571L11.959,6.571C12.046,6.571 12.129,6.608 12.19,6.672C12.251,6.736 12.286,6.823 12.286,6.914L12.286,13.086C12.286,13.177 12.251,13.264 12.19,13.328C12.129,13.392 12.046,13.429 11.959,13.429L11.306,13.429C11.22,13.429 11.137,13.392 11.075,13.328C11.014,13.264 10.98,13.177 10.98,13.086L10.98,6.914Z",fill:"inherit"}),Ue.createElement("path",{id:"Subtract",d:"M10,16.857C13.787,16.857 16.857,13.787 16.857,10C16.857,6.213 13.787,3.143 10,3.143C6.213,3.143 3.143,6.213 3.143,10C3.143,13.787 6.213,16.857 10,16.857ZM10,15.714C13.156,15.714 15.714,13.156 15.714,10C15.714,6.844 13.156,4.286 10,4.286C6.844,4.286 4.286,6.844 4.286,10C4.286,13.156 6.844,15.714 10,15.714Z",fill:"inherit"})),dn={$nest:{svg:{width:Xe.ux.rem(1.25),height:Xe.ux.rem(1.25),fill:Zt.I.Icon.Base.Inverse,stroke:"none"}}},un={$nest:{svg:{width:Xe.ux.rem(1.25),height:Xe.ux.rem(1.25),fill:Zt.I.Icon.Brand.Default,stroke:"none"}}},hn=Xe.ux.stylesheet({logButton:[dn],pauseButton:[un]}),mn=$e.UI.Node.make((({notify:e})=>Ue.createElement(ot.z,{className:hn.logButton,onClick:e({kind:"start"}),width:"full"},Ue.createElement(nt.k,{direction:"row",gap:2,align:"center"},Ue.createElement(Qt,null),Ue.createElement(at.x,{as:"span",weight:"bold",variant:"text-small"},"Track writing activity"))))),pn=$e.UI.Node.make((({state:e,notify:t})=>Ue.createElement(nt.k,{direction:"row",gap:2,align:"center"},Ue.createElement(Je.F.Fragment,null,e.pipe(o.U((({isPaused:e})=>Ue.createElement(Ue.Fragment,null,Ue.createElement(ot.z,{variant:"secondary",className:hn.pauseButton,onClick:t(e?{kind:"resume"}:{kind:"pause"}),width:"full"},Ue.createElement(nt.k,{direction:"row",gap:2,align:"center"},e?Ue.createElement(cn,null):Ue.createElement(ln,null),Ue.createElement(at.x,{as:"span",weight:"bold",variant:"text-small"},e?"Resume tracking":"Stop tracking"))),Ue.createElement(ot.z,{text:"See report",onClick:t({kind:"viewReport"}),width:"full"}))))))))),gn=$e.UI.Union.make("kind",{begin:mn,continue:pn});var fn=n(7424),kn=n(51890);const _n={background:Zt.I.Background.Base.Subdued,borderRadius:`0 0 ${Xe.ux.rem(fn.xB)} ${Xe.ux.rem(fn.xB)}`},bn=Xe.ux.stylesheet({footer:[_n],smallControls:[{"--rem":"14",$nest:{".gds-flex:nth-child(2)":{height:"18px",scale:"0.77","transform-origin":"top left","margin-right":"-11px"}}}]}),vn=$e.UI.Union.asOption($e.UI.Node.make((({state:e,notify:t})=>Ue.createElement(nt.k,{direction:"column",as:"footer",padding:2,gap:2,className:bn.footer},Ue.createElement(Je.F.Fragment,null,e.pipe(o.U((({enabledForDomain:e,domain:n})=>{const r="docs.google.com"===n?"all new Google Docs":`all new documents on ${n}`;return Ue.createElement(nt.k,{direction:"column",gap:1,className:bn.smallControls},Ue.createElement(kn.r,{label:`Automatically track ${r}`,defaultSelected:e,onChange:e=>t(e?{kind:"enableForDomain",isNewDocument:!1}:{kind:"resetForDomain"})()}))}))))))));var yn=n(5562),Cn=n(72272);const wn=$e.UI.Node.make((({notify:e,view:t})=>Ue.createElement(yn.v,{activator:Ue.createElement(an.h,{accessibilityLabel:"Settings",icon:Cn.a,variant:"tertiary",size:"small","aria-controls":"hwr-settings-menu"})},Ue.createElement(Je.F.Fragment,null,t("urls").pipe(o.U((e=>Ue.createElement(Ue.Fragment,null,Ue.createElement(yn.v.Item,{key:"howItWorks",href:e.howItWorks,target:"_blank",onClick:()=>self.open(e.howItWorks,"_blank")},"How Authorship works?"),Ue.createElement(yn.v.Item,{key:"reportAnIssue",href:e.reportAnIssue,target:"_blank",onClick:()=>self.open(e.reportAnIssue,"_blank")},"Report an issue")))))),Ue.createElement(yn.v.Item,{key:"giveFeedback",onClick:()=>{e({kind:"giveFeedback"})()}},"Give feedback"),Ue.createElement(yn.v.Separator,{role:"separator"}),Ue.createElement(yn.v.Item,{key:"turnOfAuthorship",onClick:e({kind:"optOut"})},"Turn off Authorship")))),Sn=$e.UI.Knot.make($e.UI.Grid.make((({slots:e,notify:t})=>Ue.createElement(sn.d,{onClickAway:t({kind:"trackingButtonClickAway"})},Ue.createElement(nt.k,{direction:"column",bgColor:"background-base-default",borderRadius:2,style:{boxShadow:nn.hw.boxShadow,borderColor:nn.hw.border,minWidth:"260px",position:"relative"}},Ue.createElement(nt.k,{direction:"column",padding:2,gap:2},Ue.createElement(nt.k,{direction:"row",gap:2,align:"center"},Ue.createElement(ft.J,{icon:rn.H,accessibilityLabel:"Grammarly",size:"small"}),Ue.createElement(nt.k,{direction:"row",flex:"1 0 auto",gap:1},Ue.createElement(at.x,{as:"span",variant:"text-xsmall",color:"base-subdued"},"Grammarly Authorship"),Ue.createElement(gt.V,{variant:"neutral",label:"Beta"})),Ue.createElement(nt.k,{direction:"row"},e.menu,Ue.createElement(an.h,{accessibilityLabel:"Close",icon:on.V,variant:"tertiary",onClick:t({kind:"trackingButtonCloseClick"}),size:"small"}))),e.controls),e.footer)))),{menu:wn,controls:gn,footer:vn}),xn=$e.UI.Union.make("state",{compact:tn,expanded:Sn}),En=$e.UI.Union.asOption(xn),In=$e.UI.Grid.make((({slots:e,view:t})=>Ue.createElement(Je.F.div,{"data-grammarly-part":"human-writing-report-button",style:{position:"fixed",left:t("offsetLeft"),bottom:t("offsetBottom"),zIndex:1e4}},e.popup,e.trackingButton,Ue.createElement("div",{style:{position:"absolute",left:"100%",bottom:0}},e.toast)))),Tn=$e.UI.Knot.make(In,{trackingButton:En,popup:At,toast:zt}),An=$e.UI.Union.asOption(Tn);function Rn(e){return $e.Z.fromSideEffect((t=>{e.next(t)}),G.of(null))}function Ln(e){return $e.Z.fromSideEffect((t=>{e.next(t)}),G.of(null))}function Dn(e,t){return $e.Z.fromSideEffect((e=>{t.next({kind:e.kind})}),e.pipe(Ne.oA,o.U((({urls:e})=>({howItWorksURL:e.howItWorks,learnMoreTransparencyURL:e.learnMoreTransparency,learnMoreSafetyURL:e.learnMoreSafety,learnMoreControlURL:e.learnMoreControl})))))}function Mn(e,t){return $e.Z.composeUnion({optIn:Dn(e,t),clipboardAccess:Rn(t),feedback:Ln(t)},(()=>e.pipe(Ne.oA,Oe.j("popup"),Ne.oA,o.U((e=>({kind:e}))))))}function Bn(e,t){return $e.Z.composeUnion({None:()=>G.of(null),Some:$e.Z.composeKnot({value:Mn(e,t)})},(()=>e.pipe(Ne.oA,Oe.j("popup"))))}function Pn(e,t){return $e.Z.composeUnion({documentTrackingStarted:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),domainTrackingStarted:$e.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(Ne.oA,o.U((({domain:e})=>({domain:e,wasNewDocument:!0}))))),domainTrackingStartedWhenAlreadyTracked:$e.Z.fromSideEffect((e=>{t.next({...e})}),e.pipe(Ne.oA,o.U((({domain:e})=>({domain:e,wasNewDocument:!1}))))),optedOut:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),optedIn:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),reportGenerationFailed:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),clipboardWarning:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),clipboardPermissionRequestFailed:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageDatabaseCorrupted:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageUnrecoverableError:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null)),storageServerError:$e.Z.fromSideEffect((e=>{t.next({...e})}),G.of(null))},(()=>e.pipe(Ne.oA,Oe.j("toast"),Ne.oA,o.U((e=>({kind:e}))))))}function Gn(e,t){return $e.Z.composeUnion({None:()=>G.of(null),Some:$e.Z.composeKnot({value:Pn(e,t)})},(()=>e.pipe(Ne.oA,Oe.j("toast"))))}function Un(e,t){return $e.Z.fromSideEffect((e=>{if("trackingButtonClick"===e.kind)t.next({kind:"trackingButtonClick"});else(0,p.L0)(e.kind)}),e.pipe(Ne.oA))}function Fn(e,t){return $e.Z.composeUnion({begin:$e.Z.fromSideEffect((e=>{t.next(e)}),G.of(null)),continue:$e.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(Ne.oA,o.U((({trackingState:e})=>({isPaused:"paused"===e})))))},(()=>e.pipe(Ne.oA,o.U((({trackingState:e})=>({kind:Hn(e)?"begin":"continue"}))))))}function Nn(e,t){return $e.Z.composeUnion({None:()=>G.of(null),Some:$e.Z.composeKnot({value:$e.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(Ne.oA,o.U((({enabledForDomain:e,domain:t})=>({enabledForDomain:e,domain:t})))))})},(()=>e.pipe(Ne.cp((({trackingState:e})=>Hn(e)?G.of(m.YP):G.of(m.G(e)))))))}function On(e,t){return $e.Z.fromSideEffect((e=>{t.next(e)}),e.pipe(Ne.oA,o.U((({urls:e})=>({urls:e})))))}function Hn(e){return"available"===e||"newDocument"===e}function Wn(e,t){return $e.Z.composeKnot({controls:Fn(e,t),menu:On(e,t),footer:Nn(e,t),root:$e.Z.fromSideEffect((e=>{t.next(e)}),G.of(null))})}function $n(e,t){return $e.Z.composeUnion({compact:Un(e,t),expanded:Wn(e,t)},(()=>e.pipe(Ne.oA,o.U((({trackingButtonExpanded:e})=>({state:e?"expanded":"compact"}))))))}class zn{constructor(e,t,n,r,a,o,s=qe){this.actions=t,this.errors=n,this._events=r,this._documentId=a,this._gnar=o,this._createTButtonPositionSource=s,this._state=g.h.create(m.YP),this._tButtonPosition=g.h.create(Ye),this.state=this._state.view(),this.tButtonPosition=this._tButtonPosition.view(),this._subs=new i.w,this._domain=e.view("page").view("domain").get(),this._subs.add(this._handleCSStateChange(e).subscribe()),this._subs.add(this._handleActions().subscribe()),this._subs.add(this._handleErrors().subscribe()),this._subs.add(this._handleEvents().subscribe()),this._subs.add(this._handleEnabledForDomainOnce().subscribe()),this._subs.add(this._autocloseToast().subscribe()),this._subs.add(this._handleToastShow().subscribe()),this._subs.add(s().subscribe(Fe.wW(this._tButtonPosition)))}_handleCSStateChange(e){return e.pipe(o.U((e=>{this._state.modify((t=>{var n;const i=null!==(n=e.page.humanWritingReport)&&void 0!==n?n:k.wg;return e.page.enabled&&("optedOut"===i.kind||"available"===i.kind||"enabled"===i.kind)?(0,r.zG)(t,m.UI((t=>this._reducePageStateToLocalState(e,t))),m.wp((()=>m.G(this._reducePageStateToLocalState(e))))):m.YP}))})))}_reducePageStateToLocalState({page:{domain:e,humanWritingReport:t=k.wg},dynamicConfig:n},r){var i;return{trackingState:"optedOut"===t.kind?"optedOut":"available"===t.kind?"available":(0,k.MP)(this._documentId,this._domain,t)?(0,k.Ng)(this._documentId,this._domain,t)?"tracking":"paused":"newDocument",optInPopupWasClosedOnce:"available"!==t.kind||t.optInPopUpWasClosedAtLeastOnce,trackingButtonExpanded:!!r&&r.trackingButtonExpanded,enabledForDomain:(0,k.E3)(this._domain,t),domain:e,popup:r?r.popup:m.YP,toast:r?r.toast:m.YP,urls:{...ye.ym,...null===(i=null==n?void 0:n.hwr)||void 0===i?void 0:i.urls}}}_handleEnabledForDomainOnce(){return this.actions.pipe(c.h((e=>"enableForDomain"===e.kind)),d.q(1),s.b((({isNewDocument:e})=>this._state.modify((t=>(0,r.zG)(t,m.tS((t=>{const n={...t,toast:m.G(e?"domainTrackingStarted":"domainTrackingStartedWhenAlreadyTracked")};return m.G(n)}))))))))}_handleToastShow(){return this._state.pipe(Ne.oA,Oe.j("toast"),Ne.oA,s.b((e=>{switch(e){case"documentTrackingStarted":case"domainTrackingStarted":case"domainTrackingStartedWhenAlreadyTracked":case"optedOut":case"optedIn":case"clipboardWarning":this._gnar.hwrToastShow(this._documentId,"info",e);break;case"clipboardPermissionRequestFailed":case"storageDatabaseCorrupted":case"reportGenerationFailed":case"storageUnrecoverableError":case"storageServerError":this._gnar.hwrToastShow(this._documentId,"error",e)}})))}_autocloseToast(){const e=this.actions.pipe(c.h((e=>"toastHover"===e.kind)),Oe.j("hovered"),U.O(!1));return this._state.pipe(Ne.oA,Oe.j("toast"),Ne.oA,l.w((t=>"clipboardWarning"===t?u.E:He.S3(e.pipe(l.w((e=>e?u.E:We.timer(ye.bd)))),this.actions.pipe(c.h((e=>"dismissToast"===e.kind)))))),s.b((()=>{this._state.modify((e=>(0,r.zG)(e,m.tS((e=>m.G({...e,toast:m.YP}))))))})))}_handleActions(){return this.actions.pipe(s.b((e=>{this._state.modify((t=>(0,r.zG)(t,m.tS((t=>{switch(e.kind){case"trackingButtonClick":return"available"===t.trackingState?(0,r.zG)(t.popup,m.hX((e=>"optIn"===e)),m.WG)?m.G({...t,popup:m.YP,optInPopupWasClosedOnce:!0}):(this._gnar.hwrOptInPopupShow(this._documentId),m.G({...t,popup:m.G("optIn")})):m.G({...t,trackingButtonExpanded:!0,toast:m.YP});case"trackingButtonClickAway":case"trackingButtonCloseClick":case"viewReport":return m.G({...t,trackingButtonExpanded:!1});case"pause":return m.G({...t,trackingState:"paused"});case"resume":case"start":return m.G({...t,trackingState:"tracking"});case"closeOptInPopup":return this._gnar.hwrOptInPopupClose(this._documentId),m.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:m.YP,toast:m.G("optedIn")});case"optOut":return m.G({...t,trackingState:"optedOut",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!1,popup:m.YP,toast:m.G("optedOut")});case"optIn":return m.G({...t,trackingState:"newDocument",optInPopupWasClosedOnce:!0,trackingButtonExpanded:!0,popup:m.YP,toast:m.G("optedIn")});case"enableForDomain":return m.G({...t,trackingState:e.isNewDocument?"tracking":t.trackingState});case"resetForDomain":case"toastHover":return m.G(t);case"optOutToastOkClick":case"dismissToast":case"clipboardWarningResult":return m.G({...t,toast:m.YP});case"clipboardRequestResult":return"allow"===e.result?m.G({...t,popup:m.YP}):m.G({...t,popup:m.YP,toast:m.G("clipboardWarning")});case"giveFeedback":return this._gnar.hwrGiveFeedbackButtonClick(this._documentId,this._domain),m.G({...t,popup:m.G("feedback")});case"feedbackPopupClose":return m.G({...t,popup:m.YP});case"feedbackSubmit":return this._gnar.hwrFeedbackSubmit(this._documentId,this._domain,e.feedback),m.G(t);default:(0,p.L0)(e)}})))))})))}_handleErrors(){return this.errors.pipe(s.b((e=>{this._state.modify((t=>(0,r.zG)(t,m.tS((t=>{switch(e.kind){case"reportGenerationFailed":return m.G({...t,toast:m.G("reportGenerationFailed")});case"clipboardPermissionRequestFailed":return m.G({...t,toast:m.G("clipboardPermissionRequestFailed")});case"databaseCorrupted":return m.G({...t,toast:m.G("storageDatabaseCorrupted")});case"serverError":return m.G({...t,toast:m.G("storageServerError"),trackingState:"paused"});case"unrecoverableError":return m.G({...t,toast:m.G("storageUnrecoverableError"),trackingState:"paused"})}})))))})))}_handleEvents(){return this._events.pipe(c.h((e=>"clipboardAccessRequested"===e.kind)),s.b((e=>{this._state.modify((e=>(0,r.zG)(e,m.tS((e=>m.G({...e,popup:m.G("clipboardAccess"),toast:m.YP}))))))})))}view(){return Ue.createElement(ze.w,null,Ue.createElement(Ze.L,{chunkName:"humanWritingReport"},$e.UI.mount(An,(e=this,$e.Z.composeUnion({None:()=>G.of(null),Some:$e.Z.composeKnot({value:$e.Z.composeKnot({root:()=>e.tButtonPosition,trackingButton:(t=e.state,n=e.actions,$e.Z.composeUnion({None:()=>G.of(null),Some:$e.Z.composeKnot({value:$n(t,n)})},(()=>t.pipe(Ne.cp((({trackingState:e})=>"optedOut"===e?G.of(m.YP):G.of(m.G(e)))))))),popup:Bn(e.state,e.actions),toast:Gn(e.state,e.actions)})})},(()=>e.state))))));var e,t,n}dispose(){this._subs.unsubscribe()}}const Zn=()=>u.E,Vn=()=>{const e=(0,S.CI)(document);return e?T.R(e,"keydown"):u.E};class Kn{constructor(e){this._deps=e,this._subscriptions=new i.w,this._disposables=g.h.create([]),this._listener=g.h.create(m.YP),this._copyContentListener=g.h.create(m.YP),this._ui=g.h.create(m.YP),this._checkPermissions=new a.xQ,this.isReportAvailable=g.h.create(!1),this._domain=e.CSState.view("page").view("domain").get(),this._subscriptions.add(this._handleCheckPermissions(this._checkPermissions).subscribe()),this._subscriptions.add(this._handleStateChanges(e.CSState).subscribe()),this._subscriptions.add(this._handleUIActions(this._deps.uiActions).subscribe()),this._subscriptions.add(this._handleFeatureEvents(this._deps.events).subscribe()),this._subscriptions.add(this._logStartedTracking(this._deps.uiActions,this._deps.events).subscribe()),this._subscriptions.add(this._handleErrors(this._deps.errors).subscribe()),this._subscriptions.add(this._deps.CSState.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe().subscribe((({enabled:e,humanWritingReport:t})=>{const n=this._deps.documentId,r=this._domain;this.isReportAvailable.set(e&&"enabled"===(null==t?void 0:t.kind)&&((0,k.MP)(n,r,t)||(0,k.Ng)(n,r,t)))})))}_handleStateChanges(e){return e.view("page").view((({enabled:e,humanWritingReport:t})=>({enabled:e,humanWritingReport:t}))).pipe(o.U((({enabled:e,humanWritingReport:t})=>{if(e){if(t)switch(t.kind){case"available":case"optedOut":this._checkInitUI("optedOut"===t.kind),this._disposeListener(),this._disposeCopyContentListener();break;case"enabled":this._checkInitUI(),this._checkInitListener(),this._checkInitCopyContentListener(),(0,k.Ng)(this._deps.documentId,this._domain,t)?(this._checkPermissions.next(),this._startTracking()):this._stopTracking();break;case"disabled":this._disposeListener(),this._disposeUI(),this._disposeCopyContentListener();break;default:(0,p.L0)(t)}}else this._disposeUI(),this._disposeListener(),this._disposeCopyContentListener()})))}_handleUIActions(e){return e.pipe(o.U((e=>{switch(e.kind){case"trackingButtonClick":this._deps.gnar.hwrButtonClick(this._deps.documentId);break;case"closeOptInPopup":this._deps.csToBgActions.hwrSetEnabled(!0);break;case"start":case"resume":this._deps.csToBgActions.hwrStartTracking({documentId:this._deps.documentId,domain:this._domain});break;case"enableForDomain":this._deps.gnar.hwrTrackingEnableForDomain(this._deps.documentId,this._domain),this._deps.csToBgActions.hwrStartTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"resetForDomain":this._deps.csToBgActions.hwrStopTrackingDomain({documentId:this._deps.documentId,domain:this._domain});break;case"pause":this._deps.gnar.hwrTrackingPause(this._deps.documentId),this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain});break;case"optOut":this._deps.gnar.hwrFeatureOptOut(this._deps.documentId),this._deps.csToBgActions.hwrOptOut();break;case"optIn":this._deps.gnar.hwrFeatureOptIn(this._deps.documentId),this._deps.csToBgActions.hwrOptIn();break;case"viewReport":this._deps.gnar.hwrReportButtonClick(this._deps.documentId),this._viewReport()}})))}_handleErrors(e){return e.pipe(s.b((e=>{switch(e.kind){case"serverError":case"unrecoverableError":this._deps.csToBgActions.hwrStopTracking({documentId:this._deps.documentId,domain:this._domain})}})))}_logStartedTracking(e,t){return e.pipe(c.h((({kind:e})=>"start"===e||"resume"===e)),o.U((({kind:e})=>"resume"===e)),l.w((e=>t.pipe(c.h((({kind:e})=>"knownStateMismatch"===e||"knownStateMatch"===e)),o.U((t=>({event:t,isResume:e})))))),d.q(1),s.b((({event:e,isResume:t})=>{"knownStateMismatch"===e.kind?this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,e.lengthDifference):this._deps.gnar.hwrTrackingStart(this._deps.documentId,t,0)})))}_handleFeatureEvents(e){return e.pipe(s.b((e=>{switch(e.kind){case"sourcedTextAdded":this._deps.gnar.hwrKnownSourcePaste(this._deps.documentId,e.sourceDomain,e.textLength,e.promptDetected);break;case"unknownSourceTextAdded":this._deps.gnar.hwrUnknownSourcePaste(this._deps.documentId,e.textLength);break;case"sourceAdded":this._deps.gnar.hwrKnownSourceDetect(e.sourceDomain,e.textLength,!1)}})))}_checkInitUI(e=!1){this._ui.modify((t=>(0,r.zG)(t,m.wp((()=>{const t=new zn(this._deps.CSState,this._deps.uiActions,this._deps.errors,this._deps.events,this._deps.documentId,this._deps.gnar,this._getTButtonPositionSource()),n=y.V.get({monitorAs:"human-writing-report"}).inject(C.EM.fromDocument(self.document,"grammarly-human-writing-report"),C.zs.appendChild(self.document.documentElement),w.G7.showWhenLoaded(t.view()));return!e&&this._deps.gnar.hwrButtonShow(this._deps.documentId),m.G({viewModel:t,dispose:()=>{n.dispose(),t.dispose()}})})))))}_getTButtonPositionSource(){return(0,_.Lu)()?Qe:qe}_getKeyboardEventsSource(){return(0,_.Lu)()?Vn:Zn}_startTracking(){(0,r.zG)(this._listener.get(),m.UI((e=>{e.startTracking()})))}_stopTracking(){(0,r.zG)(this._listener.get(),m.UI((e=>{e.stopTracking()})))}_checkInitListener(){this._listener.modify((e=>(0,r.zG)(e,m.wp((()=>m.G(new Ge(this._deps.documentId,this._deps.alertsState,this._deps.textObserver,this._deps.selectionSource,this._deps.CSState,this._deps.replacementListener,this._deps.events,this._deps.encryptionClient,this._deps.errors,this._getKeyboardEventsSource()(),(0,v.OB)(),this._deps.sessionId)))))))}_handleCheckPermissions(e){return e.pipe(l.w((()=>(0,v.OB)().bgRpc.api.isPermissionGranted(f.d.clipboardRead))),c.h((e=>!e)),o.U((()=>{const e=this._deps.CSState.view("page","humanWritingReport").get();return"enabled"===(null==e?void 0:e.kind)&&void 0===(null==e?void 0:e.deniedClipboardAccessSince)})),c.h(Boolean),s.b((()=>{this._deps.events.next({kind:"clipboardAccessRequested"})})),l.w((()=>this._deps.uiActions.pipe(c.h((e=>"clipboardRequestResult"===e.kind&&"allow"===e.result||"clipboardWarningResult"===e.kind)),o.U((e=>"allow"===e.result)),d.q(1)))),l.w((e=>e?(this._deps.gnar.hwrClipboardPermissionRequest(this._deps.documentId),(0,v.OB)().bgRpc.api.requestGrantPermission(f.d.clipboardRead)):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess(),u.E))),h.K((()=>(this._deps.errors.next({kind:"clipboardPermissionRequestFailed"}),u.E))),s.b((e=>{e?this._deps.gnar.hwrClipboardPermissionAllow(this._deps.documentId):(this._deps.gnar.hwrClipboardPermissionDeny(this._deps.documentId),this._deps.csToBgActions.hwrDenyClipboardAccess())})))}_checkInitCopyContentListener(){(0,_.Lu)()&&this._copyContentListener.modify((e=>(0,r.zG)(e,m.wp((()=>m.G(new x.CopyContentListener((0,v.OB)(),this._deps.CSState.view("page","humanWritingReport"),this._deps.gnar,(0,S.CI)(document)||void 0,self,(0,S.CI)(document)||void 0)))))))}_viewReport(){(0,r.zG)(this._listener.get(),m.UI((async e=>{try{const t=await e.getReportableDocument();try{const e=await this._deps.backendClient.generateReport(t);self.open(e,"_blank")}catch(e){let t="Unknown error";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),(0,b.Tb)().humanWritingReport.error("reportGenerationFailed",JSON.stringify({documentId:this._deps.documentId,error:t})),this._deps.errors.next({kind:"reportGenerationFailed"})}}catch(e){let t="Can't get reportable document from listener";"string"==typeof(null==e?void 0:e.message)?t=e.message:"string"==typeof e&&(t=e),(0,b.Tb)().humanWritingReport.error("reportGenerationFailed",JSON.stringify({documentId:this._deps.documentId,error:t})),this._deps.errors.next({kind:"reportGenerationFailed"})}})))}_disposeUI(){this._ui.modify((e=>(0,r.zG)(e,m.tS((e=>(e.dispose(),m.YP))))))}_disposeListener(){this._listener.modify((e=>(0,r.zG)(e,m.tS((e=>(e.dispose(),m.YP))))))}_disposeCopyContentListener(){this._copyContentListener.modify((e=>(0,r.zG)(e,m.tS((e=>(e.dispose(),m.YP))))))}dispose(){this._subscriptions.unsubscribe(),this._disposeUI(),this._disposeListener(),this._disposeCopyContentListener()}}},28440:(e,t,n)=>{n.r(t),n.d(t,{CopyContentListener:()=>O});var r=n(82823),i=n(8748),a=n(65882),o=n(64965),s=n(78488),c=n(65647),l=n(14765),d=n(60841),u=n(10859),h=n(55446),m=n(78084),p=n(22889),g=n(13195),f=n(97697),k=n(44424),_=n(20715),b=n(83780),v=n(64218),y=n(27628),C=n(90049),w=n(34859),S=n(74857),x=n(25770),E=n(52341),I=n(72257),T=n(70932);const A=e=>({getAll:async()=>await e.getAll(),get:async t=>await e.get(t),patch:async t=>await e.set(t),changes:e.changes});var R;!function(e){e.make=function(e,t,n,r){return{valid:!0,copiedText:n,sourceURL:e,sourceName:t,userPrompt:r}}}(R||(R={}));var L=n(37636),D=n(71351),M=n(36072),B=n(7849),P=n(91795);class G{getPromptForText(){return null}dispose(){}}class U{constructor(e,t){this._promptsSelector=e,this._responsesSelector=t,this._pairs=new Map,this._subs=new r.w,this._prompts=new M.xQ,this._pairsOutdated=x.h.create(!0),this._subs.add(this._setupMutationObserver().subscribe((()=>{this._pairsOutdated.set(!0)})))}_searchForPairs(){const e=Array.from(document.querySelectorAll(this._promptsSelector));if(e){const t=Array.from(document.querySelectorAll(this._responsesSelector));t&&t.length===e.length&&e.forEach(((e,n)=>{var r,i;const a=(null===(r=e.textContent)||void 0===r?void 0:r.trim())||null;if(a){const e=(null===(i=t[n].textContent)||void 0===i?void 0:i.trim())||null;e&&this._pairs.set((0,B.Ue)(e),{prompt:a,response:e})}}))}this._pairsOutdated.set(!1)}_setupMutationObserver(){return P.x.create(document,{attributes:!1,subtree:!0,childList:!0}).pipe((0,c.U)((e=>e.filter((e=>e.addedNodes.length>0)).some((e=>Array.from(e.addedNodes).filter((e=>e instanceof HTMLElement)).some((e=>e.matches(this._responsesSelector)||e.querySelector(this._responsesSelector))))))),(0,h.h)(Boolean))}getPromptForText(e){var t;return this._pairsOutdated.get()&&this._searchForPairs(),(null===(t=this._pairs.get((0,B.Ue)(e)))||void 0===t?void 0:t.prompt)||null}dispose(){this._subs.unsubscribe()}}const F=[{name:"OpenAI",is:e=>"chat.openai.com"===e||"chatgpt.com"===e,matcher:()=>new U('div[data-message-author-role="user"]','div[data-message-author-role="assistant"]')},{name:"Google Gemini",is:e=>"gemini.google.com"===e,matcher:()=>new U("div.query-content","div.response-content")},{name:"Claude AI",is:(e,t)=>/claude.ai\/chat\//.test(t),matcher:()=>new U("div.font-user-message","div.font-claude-message")},{name:"Perplexity AI",is:e=>/^(www\.)?perplexity\.ai$/.test(e),matcher:()=>new U(".whitespace-pre-line.break-words","div.prose")}];function N(e){return e.length>25?`${e.slice(0,25)}...`:e}class O{constructor(e,t,n,m=self,p=self,g=self){this._env=e,this._featureState=t,this._gnar=n,this._keyboardEventsTarget=m,this._mouseEventsTarget=p,this._copyEventsTarget=g,this._log=T.Y.create("CopyContentListener"),this._subs=new r.w,this._clipboardText=x.h.create(""),this._genAIMatcher=function(){const{hostname:e,href:t}=self.location;for(const n of F)if(n.is(e,t))return n.matcher();return new G}(),null==e.browserApi?(this._trackingEnabled=i.E,this._log.warn("CopyContentListener cannot be initialized, browserApi is not available")):(this._store=(0,D.T)(A(e.browserApi.preferences)),this._trackingEnabled=a.aj(o.R(document,"visibilitychange").pipe(s.b((()=>{this._log.debug("visibilitychange",document.hidden?"hidden":"visible")})),c.U((()=>!document.hidden)),l.O(!document.hidden)),t).pipe(c.U((([e,t])=>e&&(0,I.sZ)(t))),d.w((e=>e?this._env.bgRpc.api.isPermissionGranted(E.d.clipboardRead):Promise.resolve(!1))),u.shareReplay({bufferSize:1,refCount:!0})),this._subs.add(this._setupTrackingBecameEnabledHandler()),this._subs.add(this._clipboardText.pipe(h.h((e=>e.length>0))).subscribe((e=>this._onClipboardChange(e)))),this._log.info("CopyContentListener initialized"))}_readClipboard(){return m.P((()=>navigator.clipboard.readText())).pipe(p.a((e=>e.pipe(g.b(((e,t)=>(0===t&&this._log.debug("Error getting text, will retry",e.message),f.s((()=>t>0),k._(e),_.of(e).pipe(b.g(50))))))))),v.K((e=>(this._log.debug("Error getting text, after one retry, give up for now",e.message),i.E))))}_setupTrackingBecameEnabledHandler(){return this._trackingEnabled.pipe(h.h(Boolean),y.c(this._userActionSequenceHandler())).subscribe()}_userActionSequenceHandler(){const e={capture:!0,once:!1,passive:!0};return C.T(o.R(this._mouseEventsTarget,"mousedown",e),o.R(this._keyboardEventsTarget,"keydown",e),o.R(this._copyEventsTarget,"copy",e),o.R(this._copyEventsTarget,"cut",e)).pipe(d.w((t=>f.s((()=>"copy"===t.type||"cut"===t.type),m.P((()=>u.timer(50).pipe(d.w((()=>this._readClipboard()))))),m.P((()=>this._readClipboard().pipe(d.w((n=>{switch(t.type){case"mousedown":return o.R(this._mouseEventsTarget,"mouseup",e).pipe(w.h(n));case"keydown":return o.R(this._keyboardEventsTarget,"keyup",e).pipe(w.h(n));default:return i.E}}))))).pipe(S.b(150),d.w((e=>this._readClipboard().pipe(c.U((t=>[e,t]))))),h.h((([e,t])=>e!==t)),c.U((([e,t])=>t)))))),s.b((e=>{this._log.debug("Clipboard has changed after a user action. Saving:",N(e)),this._clipboardText.set(e)})))}_onClipboardChange(e){const t=this._genAIMatcher.getPromptForText(e);t&&this._log.debug("Found genAI prompt for text:",t);this._store.get().then((n=>{const r=n.copiedTextMessage;if(null==r||!(null==r?void 0:r.valid)||(null==r?void 0:r.valid)&&r.copiedText!=e){const n=new L.m;this._log.debug("New clipboard text:",N(e)),this._gnar.hwrKnownSourceDetect(self.location.origin,e.length,Boolean(t)),this._store.set(R.make(n.url,n.title,e,t||void 0))}}))}dispose(){this._subs.unsubscribe(),this._genAIMatcher.dispose()}}},37636:(e,t,n)=>{n.d(t,{m:()=>i});var r=n(55231);class i{constructor(){this.location=self.location,this._title=document.title}get url(){return this.location.href}get title(){return this._title}isGoogleDocs(){return"docs.google.com"==this.location.hostname}get documentID(){return this.isGoogleDocs()?(0,r.j)(this.location.href):null}}},72257:(e,t,n)=>{n.d(t,{E3:()=>s,MP:()=>a,Ng:()=>i,sZ:()=>o,wg:()=>r});const r={kind:"available",optInPopUpWasClosedAtLeastOnce:!1};function i(e,t,n){if("enabled"===n.kind){const r=n.domainSettings.find((({domain:e})=>e===t));return!!r&&(r.logAllDocuments?!r.pausedDocumentIds.includes(e):r.activeDocumentIds.includes(e))}return!1}function a(e,t,n){var r;if("enabled"===n.kind){const i=n.domainSettings.find((({domain:e})=>e===t));return!!i&&(!!i.logAllDocuments||((null===(r=i.pausedDocumentIds)||void 0===r?void 0:r.includes(e))||i.activeDocumentIds.includes(e)))}return!1}function o(e){return"enabled"===(null==e?void 0:e.kind)&&e.domainSettings.some((e=>e.logAllDocuments?e.logAllDocuments:e.activeDocumentIds.length>0))}function s(e,t){var n,r;return"enabled"===t.kind&&Boolean(null===(r=null===(n=t.domainSettings)||void 0===n?void 0:n.find((({domain:t})=>t===e)))||void 0===r?void 0:r.logAllDocuments)}},7849:(e,t,n)=>{n.d(t,{$2:()=>f,Hq:()=>a,QY:()=>r,Ue:()=>l,Xw:()=>d,aS:()=>c,fo:()=>p,k4:()=>m,tg:()=>g});var r,i,a,o=n(88359),s=n(69425);function c(e,t){if(e.length<=t)return e;if(t<=3)return"...";const n=Math.ceil((t-3)/2),r=Math.floor((t-3)/2);return`${e.substring(0,n)}...${e.substring(e.length-r,e.length)}`}function l(e){return e.replace(/[.,/#!$%^&*;:{}=\-_`~()\s]/g,"").toLowerCase()}function d(e){var t;return(null===(t=/^(hwr:\/\/.+$|https?:\/\/[^/]+)/.exec(e))||void 0===t?void 0:t[1])||"Undetermined"}!function(e){e.getNumInsertedLetters=function(e){return e.ops.reduce(((e,t)=>o.s.isInsertString(t)?e+o.s.getInsertLength(t):e),0)},e.getNumDeletedLetters=function(e){const t=e.ops.filter((e=>o.s.isDelete(e)));let n=0;return t.forEach((e=>{o.s.isDelete(e)&&(n+=e.delete)})),n},e.getSummary=function(e,t){return t.ops.reduce(((t,n)=>{let{retained:r,retainedPrefix:i,deleted:a,inserted:s,maximalReplacement:c}=t.summary,l=t.pointer;return o.s.isRetain(n)&&(r=`${r}${e.substring(l,l+n.retain)}`,i=0===a.length&&0===s.length?`${i}${e.substring(l,l+n.retain)}`:i,c=c.length?`${c}${e.substring(t.pointer,t.pointer+n.retain)}`:c,l+=n.retain),o.s.isDelete(n)&&(a=`${a}${e.substring(l,l+n.delete)}`,l+=n.delete),o.s.isInsertString(n)&&(s=`${s}${n.insert}`,c=`${c}${n.insert}`),{pointer:l,summary:{retained:r,retainedPrefix:i,deleted:a,inserted:s,maximalReplacement:c}}}),{pointer:0,summary:{retained:"",retainedPrefix:"",deleted:"",inserted:"",maximalReplacement:""}}).summary},e.extractMaximalReplacementString=function(e,t){return t.ops.reduce(((t,n)=>(o.s.isInsertString(n)?t.text=`${t.text}${n.insert}`:o.s.isDelete(n)?t.originalTextPointer+=n.delete:o.s.isRetain(n)&&(t.text.length&&(t.text=`${t.text}${e.substring(t.originalTextPointer,t.originalTextPointer+n.retain)}`),t.originalTextPointer+=n.retain),t)),{text:"",originalTextPointer:0}).text||null},e.singleDelta=function(e,t){if(e===t)return new s.i([]);let n=0;const r=Math.min(e.length,t.length);for(;n<r&&e[n]===t[n];)n++;let i=0;for(;n+i<r&&t[t.length-i-1]===e[e.length-i-1];)i++;const a=e.length-(n+i),o=t.length-(n+i),c=[...n>0?[{retain:n}]:[],...a>0?[{delete:a}]:[],...o>0?[{insert:t.substring(n,n+o)}]:[]];return new s.i(c)},e.isNoTextChangesDelta=function(e){return e.ops.every((e=>o.s.isInsertString(e)?!e.insert.length:!o.s.isDelete(e)||!e.delete))}}(r||(r={})),function(e){e.isTextEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char)return!1;return!0},e.isContentEqual=function(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;++n)if(e[n].char!=t[n].char||e[n].sourceContentId!=t[n].sourceContentId||e[n].isSelfAuthored!=t[n].isSelfAuthored)return!1;return!0}}(i||(i={})),function(e){e.hasPerLetterTags=function(e){return e.isSelfAuthoredTags.length==e.text.length},e.toLoggableString=function(e){const t=c(e.text,40);return`CopiedContent [text length=${e.text.length}, has per letter tags=$hasPerLetterTags({sourcedContent)}, text=${t}]`},e.eq=function(e,t){if(e.length!==t.length)return!1;const n=e.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName))),r=t.slice().sort(((e,t)=>e.text.localeCompare(t.text)||e.sourceName.localeCompare(t.sourceName)));return n.every(((e,t)=>e.text===r[t].text&&e.sourceName===r[t].sourceName))}}(a||(a={}));const u=new Set(["'","‘","’","＇","ߴ","ߵ"]),h=new Set(['"',"«","»","","“","”","„","‟","‹","›","❮","❯","❝","❞","❛","❜","〝","〞","⹂"]);function m(e,t,n){var i,a,o,s;const c=r.getSummary(e,t);return".."===c.deleted&&"…"===c.inserted&&"."===(null===(i=n[0])||void 0===i?void 0:i.key)||"…"===c.deleted&&"..."===c.inserted&&""===(null===(a=n[0])||void 0===a?void 0:a.key)||"-"===c.deleted&&"–"===c.inserted&&"-"===(null===(o=n[0])||void 0===o?void 0:o.key)||"–"===c.deleted&&"--"===c.inserted&&""===(null===(s=n[0])||void 0===s?void 0:s.key)?1:0}function p(e,t){return!!e.length&&e.split("").every(((e,n)=>{var r,i,a;return void 0!==(null===(r=t[n])||void 0===r?void 0:r.key)&&(i=t[n].key,a=e,1===i.length&&1===a.length&&(i===a||"'"===i&&u.has(a)||'"'===i&&h.has(a)))}))}function g(e){return e.map((e=>({...e,key:/\p{Letter}/u.test(e.key)?"#":e.key})))}function f(e){try{return e.replace(/<[^>]*>/g,"").replace(/^(\s*)([*\-+]|\d+\.)\s+/gm,"").replace(/!\[(.*?)\][[(].*?[\])]/g,"$1").replace(/\[([^\]]*?)\][[(].*?[\])]/g,"$1").replace(/^(\n)?\s*#{1,6}\s*( (.+))? +#+$|^(\n)?\s*#{1,6}\s*( (.+))?$/gm,"$1$3$4$6").replace(/^[=-]{2,}\s*$/gm,"").replace(/^\s*[*\- ]+\s*$/gm,"").replace(/^(\s{0,3}>\s?)+/gm,"").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/([*_]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(`{3,})[\s\S]+?\1\s*/g,"").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1").replace(/ {2}\n/g,"\v ").replace(/\n{2}/g,"\n").replace(/([^\n])$/,"$1\n")}catch(t){return e}}},91901:(e,t,n)=>{n.d(t,{$x:()=>o,F8:()=>g,Go:()=>i,Kt:()=>y,Lq:()=>l,QR:()=>I,Qy:()=>k,Vk:()=>C,Wp:()=>r,XG:()=>a,_m:()=>h,d0:()=>d,f:()=>c,gH:()=>f,gL:()=>w,ij:()=>E,j5:()=>v,jW:()=>p,l$:()=>m,lO:()=>x,os:()=>b,rx:()=>S,uj:()=>u,y1:()=>s,yw:()=>_});const r=".kix-appview-editor",i=".docos-input",a=".docs-texteventtarget-iframe",o=".kix-cursor",s=".kix-cursor-caret",c="#docs-revisions-sidebar",l='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',d="#docs-toolbar-mode-switcher",u="edit-mode",h="suggest-mode",m="titlebar-mode-indicator-container",p="#titlebar-mode-indicator-container .titlebar-request-access-button",g="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",f="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",k=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",_=".kix-page-paginated",b=".kix-page-paginated.canvas-first-page",v=".docs-horizontal-ruler",y=".docs-vertical-ruler",C="#fontSizeSelect input",w=".docs-ruler-background",S=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",E=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'},55231:(e,t,n)=>{n.d(t,{j:()=>i});var r=n(67458);function i(e){const t=e.match(/d\/(.*?)\//);return t?r.createHash("superfasthash").hash(t[1]):null}},44637:(e,t,n)=>{n.d(t,{J:()=>d});var r=n(90023),i=n(49231),a=n(15542),o=n(80724),s=n(78488),c=n(99627),l=n(14482);const d=({onChange:e,labelId:t,className:n,checkboxClassName:d,labelClassName:u,checked:h,children:m,disabled:p,useDS:g,dataGrammarlyPart:f="ui-kit-checkbox",tabIndex:k=0,onMount:_=r.Q1})=>{const[b,v]=i.useState(null!=h&&h);i.useEffect((()=>{v(Boolean(h))}),[h]);const y=t=>{t.preventDefault(),t.stopPropagation(),v(!b),null==e||e(!b)},{ref:C,onMount:w}=a.P.useElWatcher();return i.useEffect((()=>{const e=C.pipe(o.oA,s.b(_)).subscribe();return()=>e.unsubscribe()}),[]),i.createElement("div",{"data-grammarly-part":f,...(0,c.Sh)(l.checkboxContainer,n)},i.createElement("div",{...(0,c.Sh)(l.checkbox,d,b?l.checkboxChecked:null,g?l.checkboxDS:null),role:"checkbox","aria-checked":b,tabIndex:k,"aria-labelledby":t,onKeyDown:e=>{" "===e.key&&y(e)},onClick:p?r.Q1:y,ref:w},b?i.createElement("div",{className:l.checkboxCheckmark}):null),i.createElement("label",{id:t,onClick:y,className:u},m))}},96130:(e,t,n)=>{n.d(t,{E:()=>o});var r=n(49231),i=n(99627),a=n(17345);const o=({options:e,onChange:t=(()=>null),ariaLabel:n,className:o})=>{const s=[],[c,l]=r.useState(null);r.useEffect((()=>{var n;null!==c&&(null===(n=s[c])||void 0===n||n.focus()),t(null!==c?e[c].value:null)}),[c]);const d=null!==c?e[c]:null;return r.createElement("div",{"data-grammarly-part":"ui-kit-radio-group",className:o},r.createElement("div",{className:a.radioGroup,role:"radiogroup","aria-label":n,onKeyDown:t=>{if(" "!==t.key||d){if("ArrowRight"===t.key||"ArrowDown"===t.key){t.preventDefault(),t.stopPropagation();l(((c||0)+1)%e.length)}else if("ArrowLeft"===t.key||"ArrowUp"===t.key){t.preventDefault(),t.stopPropagation();const n=(c||0)-1;l(n<0?e.length-1:n)}}else t.preventDefault(),t.stopPropagation(),l(0)}},e.map(((e,t)=>{const n=(null==d?void 0:d.value)===e.value,o=0===t;return r.createElement("div",{key:e.value,...(0,i.Sh)(a.radioGroupOption,n?a.radioGroupOptionSelected:null),role:"radio",tabIndex:n||o&&!d?0:-1,"aria-checked":n,onClick:e=>{e.preventDefault(),e.stopPropagation(),l(t)},ref:e=>s.push(e)},e.render())}))))}},21136:(e,t,n)=>{n.d(t,{z:()=>h});var r=n(49231),i=n(64151);const a=({children:e,style:t,dataGrammarlyPart:n="ui-kit-iframe",...a})=>{const[o,s]=r.useState(null),c=r.useCallback((e=>{var t,n;let r=null;"contentDocument"in e.target&&(r=null!==(n=null===(t=e.target.contentDocument)||void 0===t?void 0:t.body)&&void 0!==n?n:null),s(r),r&&(r.style.margin="0",r.style.height="100vh",r.style.overflowY="hidden")}),[]);return r.createElement("iframe",{...a,style:{border:"none",...t},onLoad:c,srcDoc:"<html><body></body></html>","data-grammarly-part":n},o&&(0,i.createPortal)(e,o))};var o=n(1208),s=n(70632),c=n.n(s),l=n(6986),d=n(4798);const u=({placeholder:e,ariaLabel:t,onChange:n})=>{const[i,a]=r.useState("");return r.useEffect((()=>{n(i)}),[i]),r.createElement(r.Fragment,null,r.createElement(o.b,null,c().__css),r.createElement("div",{role:"textbox",className:c().textBox,contentEditable:!0,onInput:e=>{a(e.target.innerText)},"data-placeholder":e,"aria-placeholder":e,"aria-label":t}))},h=({placeholder:e,onChange:t,ariaLabel:n,iframeTitle:i,className:o})=>(0,l.OB)().experimentClient.isGateEnabled(d.K.CentralizeStopEventPropagation)?r.createElement("div",{className:o,style:{width:"100%",height:"128px",maxHeight:"inherit"}},r.createElement(u,{onChange:t,ariaLabel:n,placeholder:e})):r.createElement(a,{dataGrammarlyPart:"ui-kit-textbox",className:o,style:{width:"100%",height:"100%"},title:i},r.createElement(u,{onChange:t,ariaLabel:n,placeholder:e}))},78225:(e,t,n)=>{n.d(t,{V:()=>o});var r=n(49231),i=n(63039),a=n(29357);const o=e=>e.isEnabled?r.createElement(a.T,{type:"mini",size:26,className:i.feedbackFormLogoLine}):null},80882:(e,t,n)=>{n.d(t,{b:()=>w});var r=n(49231),i=n(99627),a=n(12990),o=n(63039);const s=({fixSubmitButtonOverflowBottomPadding:e,className:t,...n})=>r.createElement(r.Fragment,null,r.createElement(a.z,{...n,className:null!=t?t:o.feedbackFormSubmitButton},n.children),r.createElement(c,{isEnabled:e})),c=e=>e.isEnabled?r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPadding},r.createElement("div",{className:o.feedbackFormSubmitButtonFixOverflowBottomPaddingChild})):null,l=e=>r.createElement("div",{"data-grammarly-part":"surveys-feedback-form-thank-you",...(0,i.Sh)(o.feedbackFormContainer,o.feedbackFormContainerAlignCenter)},r.createElement("div",{className:o.feedbackFormSuccessMessageTextContainer},r.createElement("div",{className:o.feedbackFormSuccessMessageIcon}),r.createElement("div",{className:o.feedbackFormSuccessMessageTitle},"Thank you!"),r.createElement("div",{className:o.feedbackFormSuccessMessageSubtitle},"Your feedback helps us improve.")),r.createElement(s,{type:"button",kind:"success",onClick:e.onClose},"Done"));var d=n(21136),u=n(44637);const h=e=>e.domain?r.createElement(r.Fragment,null,e.withHelpText&&r.createElement("div",{className:o.feedbackFormShareDomainTitle},"Help improve Grammarly by sharing the domain you’re on:"),r.createElement(u.J,{checked:e.checked,labelId:"feedback-form-share-domain-checkbox",onChange:e.onChange,className:o.feedbackFormShareDomainCheckbox},"Include the domain ",r.createElement("b",null,e.domain)," with my feedback")):null;var m=n(78225);const p=e=>{var t;if(!e.isEnabled)return null;const n=null!==(t=e.title)&&void 0!==t?t:r.createElement("span",null,"How do you like ",r.createElement("br",null)," Grammarly?");return r.createElement("h3",{...(0,i.Sh)(o.feedbackFormTitle,e.isCompact&&o.compact)},n)};var g=n(79992),f=n(96130),k=n(29221),_=n(45321);const b=e=>{const t=[k.B.bad,k.B.ok,k.B.good];return e.isEnabled?r.createElement(r.Fragment,null,r.createElement(f.E,{ariaLabel:"Feedback Score",options:t.map((e=>({value:e,render:()=>r.createElement("div",{className:_.feedbackFormOption},r.createElement("div",{...(0,i.Sh)(_.feedbackFormOptionIcon,v(e))}),r.createElement("div",null,function(e){switch(e){case k.B.bad:return"I dislike it";case k.B.ok:return"It’s OK";case k.B.good:return"I like it";default:(0,g.vE)(e)}}(e)))}))),onChange:e.onChange,...(0,i.Sh)(o.feedbackFormScore,e.compactDisplay&&o.compact)}),!e.hideTextBoxTitle&&r.createElement("div",{className:o.feedbackFormTextBoxTitle},"Anything we can improve?")):null};function v(e){switch(e){case k.B.bad:return _.feedbackFormOptionIconDisheartening;case k.B.ok:return _.feedbackFormOptionIconNeutral;case k.B.good:return _.feedbackFormOptionIconSmiling;default:(0,g.vE)(e)}}const y=e=>{var t,n,a,c;const[l,u]=r.useState(null),[g,f]=r.useState(""),[k,_]=r.useState(null!==(t=e.domainSharedByDefault)&&void 0!==t&&t);return r.createElement("form",{"data-grammarly-part":"surveys-feedback-form-fields",...(0,i.Sh)(o.feedbackFormContainer,"center"===e.align&&o.feedbackFormContainerAlignCenter)},r.createElement("div",{className:o.feedbackFormFields},r.createElement(m.V,{isEnabled:!e.hideLogo}),r.createElement(p,{isEnabled:!e.hideTitle,title:e.title,isCompact:null!==(n=e.compactDisplay)&&void 0!==n&&n}),r.createElement(b,{isEnabled:e.withScore,compactDisplay:e.compactDisplay,hideTextBoxTitle:e.hideTextBoxTitle,onChange:u}),r.createElement(d.z,{onChange:f,placeholder:null!==(a=e.placeholderText)&&void 0!==a?a:"Your thoughts here",ariaLabel:"Feedback Text",iframeTitle:"Feedback text field",...(0,i.Sh)(o.feedbackFormTextBox,e.compactDisplay&&o.compact)}),r.createElement(h,{domain:e.domain,checked:e.domainSharedByDefault,withHelpText:!e.hideDomainHelpText,onChange:_})),r.createElement(s,{type:"submit",kind:null!==(c=e.submitButtonKind)&&void 0!==c?c:"success",disabled:e.withScore?!l:!g,fixSubmitButtonOverflowBottomPadding:e.fixSubmitButtonOverflowBottomPadding,onClick:t=>{t.preventDefault();const n=k?e.domain:void 0;e.withScore&&l?e.onSubmit({score:l,text:g,domain:n}):!e.withScore&&g&&e.onSubmit({text:g,domain:n})}},"Submit"))};var C=n(84602);const w=({hideLogo:e=!1,align:t="center",fixSubmitButtonOverflowBottomPadding:n=!1,showPostSubmitScreen:i=!0,...a})=>{const[o,s]=r.useState(!1),c=o&&i;return r.createElement("div",{style:a.style,"data-grammarly-part":"surveys-feedback-form",role:"region","aria-label":"Provide feedback","aria-live":"polite"},c?r.createElement(l,{fixSubmitButtonOverflowBottomPadding:n,onClose:a.onClose}):r.createElement(y,{...a,hideLogo:e,align:t,fixSubmitButtonOverflowBottomPadding:n,onSubmit:e=>{a.withScore?((0,C.n8)(e),a.onSubmit(e)):((0,C.TY)(e),a.onSubmit(e)),s(!0)}}))}},29221:(e,t,n)=>{var r;n.d(t,{B:()=>r}),function(e){e.bad="bad",e.ok="ok",e.good="good"}(r||(r={}))},84602:(e,t,n)=>{function r(e){return"score"in e}function i(e){if(!r(e))throw new Error("Received unexpected feedback form data without score")}function a(e){if(r(e))throw new Error("Received unexpected feedback form data with score")}n.d(t,{TY:()=>a,dK:()=>r,n8:()=>i})},98544:(e,t,n)=>{var r=n(42663),i=n(2963)(r);i.push([e.id,"._z3YOv-textBox{font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#0e101a;font-size:14px;line-height:21px;font-feature-settings:'ss03' on;background:#f9faff;border:1px solid #e7e9f5;box-sizing:border-box;border-radius:4px;padding:10px 8px;overflow-y:auto;cursor:text;width:100%;height:100%;}._z3YOv-textBox:empty:before{font-feature-settings:'ss03' on;font-family:Inter,sans-serif;font-style:normal;font-weight:normal;color:#6d758d;font-size:14px;line-height:21px;content:attr(data-placeholder)}",""]),i.locals={textBox:"_z3YOv-textBox"},e.exports=i},27645:e=>{e.exports={accordionContent:"RZ1tY",shown:"Rodx_",accordionHeader:"zZM6o",accordionItem:"SVcPo",accordionRoot:"ieqWq",accordionTrigger:"lQxeR",linkIcon:"oS7tX",headerContainer:"iMmjP",accordionIcon:"jaZE7",rotate:"Rbcv_"}},14482:e=>{e.exports={checkboxContainer:"Te37e",checkbox:"mFHkX",checkboxDS:"DdH2q",checkboxChecked:"JhHnz",checkboxCheckmark:"zShXt",spin:"tww6q"}},17345:e=>{e.exports={radioGroup:"KAzfW",radioGroupOption:"WkjDU",radioGroupOptionSelected:"onilo"}},63039:e=>{e.exports={feedbackFormContainer:"kjElf",feedbackFormContainerAlignCenter:"hkEx2",feedbackFormFields:"Ua5wJ",feedbackFormTitle:"GnQ_a",feedbackFormTextBoxTitle:"kWEW0",feedbackFormLogoLine:"osGQI",compact:"b7yYp",feedbackFormScore:"ZOSRK",feedbackFormTextBox:"l8New",feedbackFormShareDomainTitle:"Qbnj_",feedbackFormShareDomainCheckbox:"VBCx1",feedbackFormSubmitButton:"tYYGU",feedbackFormSubmitButtonFixOverflowBottomPadding:"Opd8X",feedbackFormSubmitButtonFixOverflowBottomPaddingChild:"QKLT7",feedbackFormSuccessMessageTextContainer:"ARBzt",feedbackFormSuccessMessageIcon:"kJIzg",feedbackFormSuccessMessageTitle:"iXQnf",feedbackFormSuccessMessageSubtitle:"Ydufo",spin:"Vv6WG"}},45321:e=>{e.exports={feedbackFormOption:"sp8vS",feedbackFormOptionIcon:"eH6DL",feedbackFormOptionIconDisheartening:"DhaWh",feedbackFormOptionIconNeutral:"BS_8d",feedbackFormOptionIconSmiling:"dUZNd",spin:"uouSO"}}}]);