(self.webpackChunk=self.webpackChunk||[]).push([[5275],{3621:(e,t,i)=>{i.d(t,{G:()=>o});var n=i(58303),r=i(25770),s=i(67055);class o extends s.J{constructor(){super(),this._popoverActionsHandler=r.h.create(n.YP)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(n.G(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}dispose(){this._popoverActionsHandler.set(n.YP)}}},91118:(e,t,i)=>{i.d(t,{z:()=>s});var n=i(58303),r=i(25770);class s{constructor(){this.activePopoverStack=r.h.create(n.YP),this.activePopoverView=r.h.create(n.YP),this._popoverActionsHandler=r.h.create(n.YP)}addPopover(e,t){}getInteractionActions(e,t,i){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}dispose(){}}},59407:(e,t,i)=>{i.d(t,{U:()=>F});var n=i(53186),r=i(90023),s=i(7280),o=i(36072),a=i(23858),c=i(70989),d=i(65647),l=i(14765),u=i(10859),p=i(58303),h=i(98427),v=i(52256),f=i(68259),g=i(59833),A=i(21147),m=i(25770),I=i(39569),w=i(91733),b=i(55100),y=i(8748),C=i(12518),S=i(17071);class _{constructor(){this.feed=y.E,this.currentFeed=p.YP,this.onFeedRemove=y.E,this.onFeedEmpty=y.E,this.header=y.E,this.footer=y.E,this.pushFeed=()=>C.right(null),this.popFeed=S.Q1,this.focusCard=()=>C.right(null),this.notifyCardFocused=S.Q1,this.dispose=S.Q1}}var P,G=i(83895),k=i(95486),U=i(37285),E=i(14568),M=i(94996),x=i(69706);class F{constructor(e,t,i,n,h,v,f){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=i,this.capiClient=n,this.integrationModel=h,this.getGrammarlyGoAssistantMode=v,this.onReplacement=f,this._focusedItem=m.h.create(p.YP),this._sduiInlineCardActions=new o.xQ,this._subs=new a.w.Keeper,this.focusCard=e=>{this._focusedItem.set(p.G(e))},this.handleSduiCardAction=(e,t,i)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:i})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e),(0,r.zG)(F.getSduiFeedActions(e.actions),p.UI((t=>this.integrationModel.openAssistant({type:x.WT.sdui,action:{...e,actions:t,type:s.lY.Type.sduiCardAction}}))))},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new I.x(t,e,new _,n,this._focusedItem.view(p.UI((e=>e.id))));const g=this._sduiViewModel.sduiActionEvents.pipe(c.M(this._sduiInlineCardActions.pipe(d.U(p.G),l.O(p.YP)))).subscribe((([e,t])=>this._nativeHandling(e,(0,r.zG)(t,p.UI((e=>e.match))),(0,r.zG)(t,p.UI((e=>e.cardModel)))))),A=this._sduiInlineCardActions.pipe(u.skipBy(P.eq)).subscribe((({cardAction:e})=>this._sduiViewModel.sduiActionEvents.next(e)));this._subs.push(g,A,this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:i,scope:n},s,o){(0,r.zG)(F.getSduiFeedActions(e),p.UI((e=>{(0,r.zG)(o,p.UI((r=>{r.onOpenExpandedViewBySduiAction(G.Oe.create(e,t,i,n))})))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"openPerformanceScore":case"nativeOpenUserSatisfactionFeedback":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"enableWritingExpertCheck":case"disableWritingExpertCheck":case"enableAudienceAdaptCheck":case"disableAudienceAdaptCheck":case"enableAiStudioCheck":case"disableAiStudioCheck":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"closePopover":return void this.integrationModel.closePopover(e.rootPopoverId);case"openLink":return void this.environment.actions.openPopup(new h.Z(e.url));case"copyToClipboard":return void(0,M.vQ)(e.text);case"stopApplyingAlerts":case"upgradeToPremium":return(0,r.zG)(o,p.UI((e=>e.openPlanComparisonPage({utmCampaign:k.L.Place.assistantCardList})))),void(0,r.zG)(s,p.UI((e=>e.hide())));case"applyAlerts":return void(0,r.zG)(s,p.UI((i=>{if(null==i.alert)return;const{alert:n}=i;(0,r.zG)((0,U.UQ)(n,i.plainText),(t=>new E.U_(t,(t=>i.replace(null!=t?t:"",!1,e.alternativeIndex)))),(i=>(0,r.zG)(p.ij(i.replacements[e.alternativeIndex]),p.UI((e=>i.getOnReplace(e)())),v.bw((()=>{var e;null===(e=this.onReplacement)||void 0===e||e.call(this,t,n.group,n.category)}))))),i.hide()})));case"closeCard":case"removeRoot":return void(0,r.zG)(s,p.UI((e=>e.hide())));case"removeAlerts":return void(0,r.zG)(s,p.UI((e=>{e.ignore(),e.hide()})));case"openGrammarlyGo":return void(0,r.zG)(p.RD([o,s]),p.UI((([e,t])=>{var i,n;const r=(t,i)=>{const n=this.getGrammarlyGoAssistantMode();e.onOpenGrammarlyGo({assistantMode:n,genAIParams:t,source:i})};if(t.alert&&(0,b.t)(t.alert.patternName)){const e=(0,U.UQ)(t.alert,t.plainText);if(e.length>0&&e[0].newText){const i=e[0].newText;r({genAISessionMode:"pushRewrite",writingExpertContext:{alertId:t.alert.id,alertPname:t.alert.patternName,originalText:t.alert.text,replacementText:i},transformRange:t.alert.transformRange},{kind:"inlinePushRewriteSource"})}else r({genAISessionMode:"ideation"},{kind:"inlinePushRewriteSource"})}else r({genAISessionMode:"ideation"},{kind:"inlineCardSource",alertId:null!==(n=null===(i=t.alert)||void 0===i?void 0:i.id)&&void 0!==n?n:null})})));default:(0,f.L0)(e)}}))}}F.getSduiFeedActions=(0,r.ls)(g.hX((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type)),n.nI),function(e){e.eq=A.MW({cardAction:w.t.eq})}(P||(P={}))},75395:(e,t,i)=>{i.r(t),i.d(t,{createSduiInlineEngine:()=>M,default:()=>x});var n=i(90023),r=i(92346),s=i(23858),o=i(55446),a=i(65647),c=i(58303),d=i(8280),l=i(8471),u=i(67768),p=i(49966),h=i(57216),v=i(19813),f=i(33774),g=i(25583),A=i(14765),m=i(96030),I=i(88245);function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var n,r,s=[],o=!0,a=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(s.push(n.value),!t||s.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(a)throw r}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=function(){function e(t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),y(this,"_state",new Map),y(this,"_subs",new s.w.Keeper),y(this,"_log",v.C8.Logging.getLogger("SDUIInlineManager",v.zW.i.TRACE,v.zW.T.Manager.getColor())),this._subs.push(t.pipe(A.O(I.a.empty),m.G(),a.U((function(e){var t=C(e,2),i=t[0],n=t[1];return I.a.diff(i,n)})),a.U((function(e){return i._processSDUIItems(e)}))).subscribe())}var t,i,r;return t=e,(i=[{key:"getInlineItemForAlert",value:function(e){return c.ij(this._state.get(e))}},{key:"_processSDUIItems",value:function(e){var t=this;(0,n.zG)(e,g.v.forEach((function(e){_(e)&&(t._log.trace("inline item removed",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(e){return t._state.delete(e)})))}),(function(e,i){_(i)&&(t._log.trace("inline item updated",{alertIds:i.alertIds,itemId:i.id}),i.alertIds.forEach((function(e){return t._state.set(e,i)})))}),(function(e){_(e)&&(t._log.trace("inline item added",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(i){return t._state.set(i,e)})))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&b(t.prototype,i),r&&b(t,r),e}(),_=function(e){return(0,n.zG)(f.ab.findFirst(e.content,"inlineCard"),c.pC)},P=i(99987),G=i(59407),k=i(83895),U=i(3621),E=i(91118);const M=({sduiBufferService:e,alertState:t,getByRawAlertId:i,sendUserAction:v,environment:f,capiClient:g,integrationModel:A,getGrammarlyGoAssistantMode:m,onReplacement:I,sduiPopoversSupported:w=!1})=>{const b=new s.w.Keeper,y=(0,n.ls)((e=>e.toString()),i,c.ij,c.UI((e=>d.j.AlertId.from(e.id)))),C=e.capiEvents.pipe(o.h(r.hX.is("sdui_add","sdui_remove","sdui_update")),o.h((e=>"sdui_remove"===e.kind||k.D1.InlineCard.isInlineCard(e.sdui)||k.D1.StrongAlertRef.isStrongAlertRefUpgradeHookContent(e.sdui)||k.D1.GButton.isGButtonContent(e.sdui)||k.D1.PopoverStack.isPopoverStack(e.sdui)||l.vK.isGlobalPart(e.sdui))),o.h(u.e.isSduiEvent),a.U(p.al.fromSource(p.i5.CAPI))),_=w?new U.G:new E.z,M=new h.G(C,y,_),x=new S(M.state),F=new P.Q({sendUserAction:v}),z=new G.U(M,F,f,g,A,m,I);return _.setPopoverActionsHandler(z),b.push(t.subscribe((e=>M.notifyAlertsChanged())),e.capiEvents.pipe(o.h(r.hX.is("session_started")),o.h((e=>e.isNewSession))).subscribe((e=>M.onSessionStarted())),e.capiEvents.pipe(o.h(r.hX.is("finish")),o.h((e=>0===e.revision))).subscribe((e=>M.onFirstCheckingFinished())),M,x,z),{sduiBufferService:e,sduiManager:M,sduiInlineManager:x,sduiFeedbackService:F,inlineCardViewModel:z,dispose:()=>{b.dispose(),_.dispose()}}},x={createSduiInlineEngine:M}},94996:(e,t,i)=>{i.d(t,{Sz:()=>s,vQ:()=>r});var n=i(12518);async function r(e,t=self){if(function(e=self){var t,i;return!!(null===(i=null===(t=e.navigator)||void 0===t?void 0:t.clipboard)||void 0===i?void 0:i.writeText)}(t))return t.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function s(e,t=self){return r(e,t).then((()=>n.right(void 0))).catch((e=>n.left(e instanceof Error?e:new Error(String(e)))))}}}]);