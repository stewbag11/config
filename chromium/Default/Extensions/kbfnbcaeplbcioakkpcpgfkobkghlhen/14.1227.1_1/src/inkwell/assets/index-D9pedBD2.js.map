{"version":3,"file":"index-D9pedBD2.js","sources":["../../../feature-document-session-ui/src/index.ts"],"sourcesContent":["/**\n * This feature package composes the UI for a document session.\n * @packageDocumentation\n */\n\nimport type { Activate } from '@grammarly/feature'\nimport { pipe } from '@grammarly/util-function'\nimport { Result, ResultDisposable } from '@grammarly/util-result'\nimport React from 'react'\n\nimport { createInjectionToken, Lifetime } from '@grammarly/util-dependency-container'\nimport { type ViewContainer, DefaultViewContainer } from '@grammarly/util-view-container'\n\nimport type {} from '@grammarly/feature-document-session'\nimport type {} from '@grammarly/feature-ui'\n\n/**\n * The slots for the document-session ViewContainer.\n * @public\n */\nexport interface DocumentSessionViewContainerSlots {\n  readonly decorations: never\n  readonly default: never\n}\n\n/**\n * The document-session ViewContainer.\n * @public\n */\nexport type DocumentSessionViewContainer = ViewContainer<DocumentSessionViewContainerSlots>\n\n/**\n * Token to inject {@link DocumentSessionViewContainer}.\n * @public\n */\nexport const DocumentSessionViewContainerToken = createInjectionToken<DocumentSessionViewContainer>(\n  Symbol('DocumentSessionViewContainer'),\n)\n\nconst DefaultViewContainerToken =\n  createInjectionToken<DefaultViewContainer<DocumentSessionViewContainerSlots>>()\n\n/** @public */\nexport const activate: Activate = context =>\n  pipe(\n    Result.all([context.getFeature('ui'), context.getExecutionScope('document-session')] as const),\n    Result.flatMap(([uiFeature, documentSessionScope]) =>\n      ResultDisposable.all([\n        documentSessionScope.register({\n          token: DocumentSessionViewContainerToken,\n          useToken: DefaultViewContainerToken,\n        }),\n        documentSessionScope.register(\n          {\n            token: DefaultViewContainerToken,\n            useClass: DefaultViewContainer,\n          },\n          { lifetime: Lifetime.ContainerScoped },\n        ),\n        Result.success(\n          documentSessionScope.onStart(async execution =>\n            pipe(\n              Result.all([\n                execution.resolve(uiFeature.provides.MainViewContainer),\n                execution.resolve(DefaultViewContainerToken),\n              ] as const),\n              Result.map(([mainViewContainer, viewContainer]) => {\n                const DocumentSessionView = () => {\n                  const slots = React.useSyncExternalStore(\n                    viewContainer.subscribe,\n                    viewContainer.getSnapshot,\n                  )\n                  return React.createElement(\n                    'document-session-view-container',\n                    {\n                      'data-document-id': execution.api.document.id,\n                    },\n                    slots.decorations?.map(slot =>\n                      React.cloneElement(slot.view, { key: slot.key }),\n                    ),\n                    slots.default?.map(slot => React.cloneElement(slot.view, { key: slot.key })),\n                  )\n                }\n\n                return mainViewContainer.add(DocumentSessionView, { slot: 'default' })\n              }),\n            ),\n          ),\n        ),\n      ]),\n    ),\n  )\n"],"names":["DocumentSessionViewContainerToken","createInjectionToken","DefaultViewContainerToken","activate","context","pipe","Result.all","Result.flatMap","uiFeature","documentSessionScope","ResultDisposable","DefaultViewContainer","Lifetime","Result.success","execution","Result.map","mainViewContainer","viewContainer","DocumentSessionView","_a","_b","slots","React","slot"],"mappings":"8MAmCO,MAAMA,EAAoCC,EAC/C,OAAO,8BAA8B,CACvC,EAEMC,EACJD,EAA8E,EAGnEE,EACXC,GAAAC,EACEC,EAAW,CAACF,EAAQ,WAAW,IAAI,EAAGA,EAAQ,kBAAkB,kBAAkB,CAAC,CAAU,EAC7FG,EAAe,CAAC,CAACC,EAAWC,CAAoB,IAC9CC,EAAiB,IAAI,CACnBD,EAAqB,SAAS,CAC5B,MAAOT,EACP,SAAUE,CAAA,CACX,EACDO,EAAqB,SACnB,CACE,MAAOP,EACP,SAAUS,CACZ,EACA,CAAE,SAAUC,EAAS,eAAgB,CACvC,EACAC,EACEJ,EAAqB,QAAQ,MAAMK,GACjCT,EACEC,EAAW,CACTQ,EAAU,QAAQN,EAAU,SAAS,iBAAiB,EACtDM,EAAU,QAAQZ,CAAyB,CAAA,CACnC,EACVa,EAAW,CAAC,CAACC,EAAmBC,CAAa,IAAM,CACjD,MAAMC,EAAsB,IAAM,CAnElD,IAAAC,EAAAC,EAoEkB,MAAMC,EAAQC,EAAM,qBAClBL,EAAc,UACdA,EAAc,WAAA,EAEhB,OAAOK,EAAM,cACX,kCACA,CACE,mBAAoBR,EAAU,IAAI,SAAS,EAC7C,GACAK,EAAAE,EAAM,cAAN,KAAmB,OAAAF,EAAA,IAAII,GACrBD,EAAM,aAAaC,EAAK,KAAM,CAAE,IAAKA,EAAK,IAAK,CAAA,GAEjDH,EAAMC,EAAA,UAAN,KAAe,OAAAD,EAAA,IAAYG,GAAAD,EAAM,aAAaC,EAAK,KAAM,CAAE,IAAKA,EAAK,IAAK,CAAA,CAAA,CAC5E,EAGF,OAAOP,EAAkB,IAAIE,EAAqB,CAAE,KAAM,UAAW,CAAA,CACtE,CACH,CACF,CACF,CAAA,CACD,CACH,CACF"}