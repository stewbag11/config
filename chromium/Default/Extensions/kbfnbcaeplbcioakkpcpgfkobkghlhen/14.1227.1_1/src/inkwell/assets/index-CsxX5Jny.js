var p=t=>{throw TypeError(t)};var k=(t,e,r)=>e.has(t)||p("Cannot "+r);var i=(t,e,r)=>(k(t,e,"read from private field"),r?r.call(t):e.get(t)),u=(t,e,r)=>e.has(t)?p("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),a=(t,e,r,s)=>(k(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);var d=(t,e,r,s)=>({set _(h){a(t,e,h,r)},get _(){return i(t,e,s)}});import{n as g,R as w,w as b}from"./index-D8eA2Snd.js";var n,o,c,f;class j{constructor(e){u(this,n,!1);u(this,o,0);u(this,c,null);u(this,f);a(this,f,e)}peek(){if(i(this,n)&&g)throw new w;return i(this,f)}take(){if(i(this,n)&&g)throw new w;let e=!1;d(this,o)._++;const r=()=>this.peek(),s=()=>{var m;e||(e=!0,y(),--d(this,o)._===0&&((m=i(this,c))==null||m.call(this)))},h=Object.seal({get value(){return r()},release:s,[Symbol.dispose]:s}),y=D(h);return h}get inUse(){return i(this,o)>0}async[Symbol.asyncDispose](){i(this,n)||(i(this,o)===0?a(this,n,!0):await new Promise(e=>{a(this,c,()=>{a(this,n,!0),e()})}))}}n=new WeakMap,o=new WeakMap,c=new WeakMap,f=new WeakMap;let R=g,l=null;function D(t){if(!R)return()=>{};if(l===null){const r=b.createLogger("AutomaticRefCounted");l=new FinalizationRegistry(s=>{r.warn("Memory leak detected: ".concat(s))})}const e=Object.create(null);return l.register(t,L(3),e),()=>l==null?void 0:l.unregister(e)}function L(t){const e=new Error;return e.stack===void 0?"":e.stack.split("\n").slice(t+1,t+2).join("\n").trimStart()}export{j as A};
//# sourceMappingURL=index-CsxX5Jny.js.map
