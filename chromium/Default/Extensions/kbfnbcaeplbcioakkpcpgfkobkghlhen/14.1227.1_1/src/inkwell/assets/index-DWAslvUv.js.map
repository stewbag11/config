{"version":3,"file":"index-DWAslvUv.js","sources":["../../../util-scheduling/dist/Scheduler-DvDgjE.mjs","../../../util-scheduling/dist/SingletonTaskQueue-DS_FfG.mjs","../../../util-geometry/dist/ViewportPointFns-DpM1h7.mjs","../../../util-math/dist/index.mjs","../../../util-set/dist/index.mjs"],"sourcesContent":["import { CustomError } from '@grammarly/util-error';\nimport { Result } from '@grammarly/util-result';\nimport { setZeroTimeout } from './setZeroTimeout-D71IJA.mjs';\n\n/**\n * A scheduler that executes the task in the animation frame.\n * The returned result will error if the task rejects or throw or if the task is aborted.\n * @public\n */\nconst animationFrameScheduler = (task, options) => new Promise(resolve => {\n    const rafId = requestAnimationFrame(async () => {\n        if (options?.signal?.aborted) {\n            return resolve(Result.failure(new AbortError(options.signal.reason)));\n        }\n        try {\n            resolve(Result.success(await task()));\n        }\n        catch (error) {\n            resolve(Result.fromUnknownError(error));\n        }\n    });\n    if (options?.signal) {\n        const onAbort = () => {\n            cancelAnimationFrame(rafId);\n            resolve(Result.failure(new AbortError(options.signal?.reason)));\n            options.signal?.removeEventListener('abort', onAbort);\n        };\n        options.signal.addEventListener('abort', onAbort);\n    }\n});\n/**\n * A scheduler that executes the task in the microtask queue.\n * The returned result will error if the task rejects or throw or if the task is aborted.\n * @public\n */\nconst microtaskScheduler = (task, options) => new Promise(resolve => {\n    queueMicrotask(async () => {\n        if (options?.signal?.aborted) {\n            return resolve(Result.failure(new AbortError(options.signal.reason)));\n        }\n        try {\n            resolve(Result.success(await task()));\n        }\n        catch (error) {\n            resolve(Result.fromUnknownError(error));\n        }\n    });\n});\n/**\n * Create a scheduler that executes the task using a mechanism similar to setTimeout(0), but faster.\n * The returned result will error if the task rejects or throw or if the task is aborted.\n * @public\n */\nconst zeroTimeoutScheduler = (task, options) => new Promise(resolve => {\n    setZeroTimeout(async () => {\n        if (options?.signal?.aborted) {\n            return resolve(Result.failure(new AbortError(options.signal.reason)));\n        }\n        try {\n            resolve(Result.success(await task()));\n        }\n        catch (error) {\n            resolve(Result.fromUnknownError(error));\n        }\n    });\n});\n/**\n * Create a scheduler that executes the task using setTimeout.\n * The returned result will error if the task rejects or throw or if the task is aborted.\n * @public\n */\nfunction createTimeoutScheduler(delay = 0) {\n    return (task, options) => new Promise(resolve => {\n        const timeout = setTimeout(async () => {\n            if (options?.signal?.aborted) {\n                return resolve(Result.failure(new AbortError(options.signal.reason)));\n            }\n            try {\n                resolve(Result.success(await task()));\n            }\n            catch (error) {\n                resolve(Result.fromUnknownError(error));\n            }\n        }, delay);\n        if (options?.signal) {\n            const onAbort = () => {\n                clearTimeout(timeout);\n                resolve(Result.failure(new AbortError(options.signal?.reason)));\n                options.signal?.removeEventListener('abort', onAbort);\n            };\n            options.signal.addEventListener('abort', onAbort);\n        }\n    });\n}\nclass AbortError extends CustomError {\n    constructor(reason) {\n        super(reason instanceof Error ? reason.message : String(reason));\n    }\n}\n\nexport { AbortError, animationFrameScheduler, createTimeoutScheduler, microtaskScheduler, zeroTimeoutScheduler };\n//# sourceMappingURL=Scheduler-DvDgjE.mjs.map\n","import { pipe, constVoid } from '@grammarly/util-function';\nimport { logger } from '@grammarly/util-logging';\nimport { Result } from '@grammarly/util-result';\nimport { AbortError } from './Scheduler-DvDgjE.mjs';\n\n/**\n * Create a SingletonTaskQueue instance.\n * @public\n * @param task - The task to execute.\n * @param scheduler - The scheduler to use for scheduling the task.\n * @returns A SingletonTaskQueue instance\n */\nfunction createSingletonTaskQueue(task, scheduler) {\n    let queuedTask = null;\n    let taskScheduledOrRunning = false;\n    const abortTask = (reason) => {\n        queuedTask?.abortController.abort(reason);\n        queuedTask?.resolvers.resolve(Result.failure(new AbortError(reason ?? 'signal is aborted without reason')));\n        queuedTask = null;\n    };\n    const scheduleTask = ({ resolvers }) => {\n        taskScheduledOrRunning = true;\n        scheduler(async () => {\n            if (!queuedTask)\n                return;\n            const cachedTask = queuedTask;\n            // When the task starts running, we consider the queue empty\n            queuedTask = null;\n            await task(...cachedTask.args);\n        }, { signal: queuedTask?.abortController.signal }).then(result => {\n            taskScheduledOrRunning = false;\n            resolvers.resolve(pipe(result, Result.map(constVoid)));\n            // Run next execution if anything was queued\n            if (queuedTask) {\n                scheduleTask(queuedTask);\n            }\n        }, error => {\n            logger.error('Unexpected error when scheduling task in createSingletonTaskQueue()', error);\n            taskScheduledOrRunning = false;\n            resolvers.resolve(Result.fromUnknownError(error));\n            // Run next execution if anything was queued\n            if (queuedTask) {\n                scheduleTask(queuedTask);\n            }\n        });\n    };\n    return {\n        enqueue: (...args) => {\n            const resolvers = queuedTask?.resolvers ?? Promise.withResolvers();\n            queuedTask = {\n                resolvers,\n                args,\n                abortController: queuedTask?.abortController ?? new AbortController(),\n            };\n            // Kick-off an execution if none is running\n            if (!taskScheduledOrRunning) {\n                scheduleTask(queuedTask);\n            }\n            return resolvers.promise;\n        },\n        get empty() {\n            return !queuedTask;\n        },\n        cancel: abortTask,\n        [Symbol.dispose]: abortTask,\n    };\n}\n\nexport { createSingletonTaskQueue };\n//# sourceMappingURL=SingletonTaskQueue-DS_FfG.mjs.map\n","/**\n * Create a ViewportPoint.\n * @public\n */\nfunction create(p) {\n    return p;\n}\n\nexport { create };\n//# sourceMappingURL=ViewportPointFns-DpM1h7.mjs.map\n","/**\n * Utilities for mathematical operations\n * @packageDocumentation\n */\n/**\n * Compares two numbers for equality within a specified epsilon.\n * @public\n * @param a - The first number to compare.\n * @param b - The second number to compare.\n * @param epsilon - The maximum allowed difference between the numbers.\n * @returns `true` if the numbers are equal within the epsilon, false otherwise.\n */\nfunction equal(a, b, epsilon = Number.EPSILON) {\n    return Math.abs(a - b) <= epsilon;\n}\n/**\n * Round a number to a specified precision (decimal places).\n * @public\n * @param x - The number to round.\n * @param precision - The number of decimal places to round to.\n * @returns The rounded number.\n */\nfunction round(x, precision = 0) {\n    // epsilon is used to ensure things like 1.005 get rounded properly\n    return precision === 0\n        ? (0.5 + x) | 0\n        : Math.round((x + Number.EPSILON) * 10 ** precision) / 10 ** precision;\n}\n\nexport { equal, round };\n//# sourceMappingURL=index.mjs.map\n","/**\n * Utilities for working with sets.\n * @packageDocumentation\n */\n/**\n * Check if two sets are equal.\n * @public\n */\nfunction equal(a, b) {\n    if (a.size !== b.size)\n        return false;\n    for (const x of a) {\n        if (!b.has(x))\n            return false;\n    }\n    return true;\n}\n\nexport { equal };\n//# sourceMappingURL=index.mjs.map\n"],"names":["microtaskScheduler","task","options","resolve","_a","Result.failure","AbortError","Result.success","error","Result.fromUnknownError","createTimeoutScheduler","delay","timeout","onAbort","_b","CustomError","reason","createSingletonTaskQueue","scheduler","queuedTask","taskScheduledOrRunning","abortTask","scheduleTask","resolvers","cachedTask","result","pipe","Result.map","constVoid","logger","args","create","p","equal","a","b","epsilon","round","x","precision"],"mappings":"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"}